import{a as Qe,b as Y,c as ge,d as ve,h as Je,i as en}from"./chunk-DDWS3SNK.js";import{$a as Q,Aa as te,Ab as Ze,Bb as Ke,Ca as Yt,Db as j,Fa as Ge,G as he,H as U,I as _t,Ia as je,K as _e,Ka as He,La as Le,M as v,Ma as V,Na as b,Oa as M,Pa as $,Qa as We,R,Ra as Ae,S as B,Sa as ne,Ta as Ce,Va as G,X as Be,Ya as Ue,Za as ze,_a as pe,a as W,aa as E,ab as Xt,b as ee,ba as Ee,bb as x,ca as me,cb as xe,da as bt,db as ie,ea as be,eb as $e,f as Wt,fa as Ct,fb as qt,gb as Zt,hb as Kt,i as Ut,ib as fe,jb as re,kb as se,mb as ae,n as zt,na as g,ob as p,pb as Ye,qb as Qt,rb as Xe,s as $t,sa as Mt,sb as Jt,ta as z,ub as wt,vb as Vt,xa as I,ya as Dt,za as Z,zb as qe}from"./chunk-UM4DY465.js";function tn(n,e,t,i,r){let s=n[t][Math.min(i-1,e+1)].height-n[t][Math.max(0,e-1)].height,o=n[Math.min(r-1,t+1)][e].height-n[Math.max(0,t-1)][e].height,a=.5+(s-o)*20;return Math.max(.3,Math.min(1.4,a))}var St=(n,e,t)=>n+(e-n)*t,nn=(n,e,t)=>[Math.round(St(n[0],e[0],t)),Math.round(St(n[1],e[1],t)),Math.round(St(n[2],e[2],t))];var Et=(n,e)=>{let t=Math.max(0,Math.min(1,n.height)),i=e===void 0?void 0:ge("sea").threshold+(1+e)*.0015,r=ve(t,i),s=ge(r),o=Object.values(Qe),a=o.findIndex(h=>h===r)-1,u=a>=0?ge(o[a]).threshold??1:0,l=(t-u)/(s.threshold-u),c=ge("sea"),d=n.isWater?c.colorFrom:s.colorFrom,m=n.isWater?c.colorTo:s.colorTo;return nn(d,m,l)},Me=(n,e)=>{let[t,i,r]=Et(n,e);return`rgb(${t},${i},${r})`};var rn=(n,e,t)=>{let i=e.length,r=e[0]?.length??0;if(!r||!i)return;n.width=r,n.height=i;let s=n.getContext("2d");if(!s)return;let o=s.createImageData(r,i),{data:a}=o,u=0;for(let l=0;l<i;l++){let c=e[l];for(let d=0;d<r;d++){let[m,h,C]=Et(c[d],t),y=tn(e,d,l,r,i);a[u++]=Math.min(255,m*y),a[u++]=Math.min(255,h*y),a[u++]=Math.min(255,C*y),a[u++]=255}}s.putImageData(o,0,0)};var At={radius:5,width:4,color:"#ff265c"};function on(n,e,t,i){let r=n.getContext("2d");!r||!e||(r.clearRect(0,0,n.width,n.height),r.drawImage(e,0,0),r.beginPath(),r.arc(t,i,At.radius,0,Math.PI*2),r.lineWidth=At.width,r.strokeStyle=At.color,r.stroke(),r.closePath())}var K=(n,e,t)=>()=>{let i=n+++(e??0)*374761393+(t??0)*668265263,r=Math.sin(i)*1e4;return r-Math.floor(r)};var Wn=(n,e)=>{let t=ge(n).plantDensity??0;if(e()>t)return null;let i=Object.entries(Je).filter(([,a])=>a.locations.some(u=>u.location===n));if(i.length===0)return null;let r=i.map(([,a])=>a.locations.find(u=>u.location===n).probability),s=r.reduce((a,u)=>a+u,0);if(s<=0)return null;let o=e()*s;for(let a=0;a<i.length;a++){if(o<r[a])return i[a][0];o-=r[a]}return null},sn=(n,e,t,i,r=32)=>{let s=Array.from({length:r},()=>new Array(r)),o=n+e*73856+t*19349,a=K(o);for(let u=0;u<r;u++)for(let l=0;l<r;l++){let c=l/r,d=u/r,m=(1-c)*i.tl.height+c*i.tr.height,h=(1-c)*i.bl.height+c*i.br.height,C=(1-d)*m+d*h,y=Math.max(0,Math.min(1,C)),w=ve(y),S=Object.values(i).filter(_=>_.isWater).find(_=>w===ve(_.height));w!=="sea"&&S&&(w="inlandWaters");let f=Wn(w,a);s[u][l]={height:y,isWater:w==="inlandWaters"||w==="sea",biome:w,plant:f}}return s};var cn=Math.sqrt(3),dn=Math.sqrt(5),Un=.5*(cn-1),Fe=(3-cn)/6,Qi=1/3,Ji=1/6,er=(dn-1)/4,tr=(5-dn)/20,an=n=>Math.floor(n)|0,ln=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function et(n=Math.random){let e=zn(n),t=new Float64Array(e).map(r=>ln[r%12*2]),i=new Float64Array(e).map(r=>ln[r%12*2+1]);return function(s,o){let a=0,u=0,l=0,c=(s+o)*Un,d=an(s+c),m=an(o+c),h=(d+m)*Fe,C=d-h,y=m-h,w=s-C,D=o-y,S,f;w>D?(S=1,f=0):(S=0,f=1);let _=w-S+Fe,A=D-f+Fe,F=w-1+2*Fe,T=D-1+2*Fe,H=d&255,L=m&255,ce=.5-w*w-D*D;if(ce>=0){let q=H+e[L],oe=t[q],Se=i[q];ce*=ce,a=ce*ce*(oe*w+Se*D)}let de=.5-_*_-A*A;if(de>=0){let q=H+S+e[L+f],oe=t[q],Se=i[q];de*=de,u=de*de*(oe*_+Se*A)}let ue=.5-F*F-T*T;if(ue>=0){let q=H+1+e[L+1],oe=t[q],Se=i[q];ue*=ue,l=ue*ue*(oe*F+Se*T)}return 70*(a+u+l)}}function zn(n){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(n()*(256-i)),s=t[i];t[i]=t[r],t[r]=s}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var tt=class{config;prng;shapeNoise;warpNoise;detailNoise;constructor(e){this.config=W({scale:1.5,lacunarity:2,persistance:.5,octaves:6,lakeProbability:.3},e),this.prng=K(this.config.seed),this.shapeNoise=et(this.prng),this.warpNoise=et(this.prng),this.detailNoise=et(this.prng)}generateMap(){let{width:e,height:t,octaves:i,persistance:r,lacunarity:s,scale:o,lakeProbability:a}=this.config,u=Array.from({length:t},()=>new Array(e));for(let c=0;c<t;c++)for(let d=0;d<e;d++){let m=(d/e-.5)*2*(e/t),h=(c/t-.5)*2,C=this.warpNoise(m*1.5,h*1.5),y=this.warpNoise(m*1.5+5.2,h*1.5+1.3),D=1-Math.sqrt((m+C*.3)**2+(h+y*.3)**2);D+=this.shapeNoise(m*.8,h*.8)*.3;let S=Math.min(d,c,e-1-d,t-1-c)/(Math.min(e,t)*.1);if(D*=Math.min(1,S),D<=0){u[c][d]=0;continue}let f=0,_=1,A=o,F=0;for(let H=0;H<i;H++){let L=this.detailNoise(m*A,h*A);H>0?(L=1-Math.abs(L),L*=L):L=(L+1)/2,f+=L*_,F+=_,_*=r,A*=s}let T=f/F*D;T**=2.5,u[c][d]=Math.max(0,Math.min(1,T))}let l=this.calculateWaterBodies(u,e,t,a);return u.map((c,d)=>c.map((m,h)=>({height:m,isWater:l[d][h]})))}calculateWaterBodies(e,t,i,r){let s=Array.from({length:i},()=>new Array(t).fill(!1)),o=Array.from({length:i},()=>new Array(t).fill(!1)),a=[{min:Y.sea.threshold,max:Y.waterfront.threshold},{min:Y.waterfront.threshold,max:Y.grass.threshold},{min:Y.grass.threshold,max:Y.forest.threshold}];for(let u=0;u<i;u++)for(let l=0;l<t;l++){if(o[u][l])continue;let c=e[u][l];if(c<Y.sea.threshold){s[u][l]=!0,o[u][l]=!0;continue}for(let d of a)if(c>=d.min&&c<d.max){this.processRegion(l,u,t,i,e,o,s,d,r);break}}return s}processRegion(e,t,i,r,s,o,a,u,l){let c=[{x:e,y:t}],d=[],m=new Set;o[t][e]=!0;let h=0;for(;h<c.length;){let{x:y,y:w}=c[h++];d.push({x:y,y:w}),m.add(w*i+y);let D=[1,-1,0,0],S=[0,0,1,-1];for(let f=0;f<4;f++){let _=y+D[f],A=w+S[f];if(_>=0&&_<i&&A>=0&&A<r){let F=s[A][_];!o[A][_]&&F>=u.min&&F<u.max&&(o[A][_]=!0,c.push({x:_,y:A}))}}}let C=!1;for(let{x:y,y:w}of d){for(let D=-2;D<=2;D++){for(let S=-2;S<=2;S++){let f=y+S,_=w+D;if(f<0||f>=i||_<0||_>=r){C=!0;break}if(!m.has(_*i+f)&&s[_][f]<u.max){C=!0;break}}if(C)break}if(C)break}if(!C&&this.prng()<l)for(let y of d)a[y.y][y.x]=!0}};var De=class n{chunkCache=new Map;imageCache={};preloadImages(e){let t=[...Object.entries(Y),...Object.entries(Je)],i=0;t.forEach(([r,s])=>{let o=new Image;o.src=s.image,o.onload=()=>{this.imageCache[r]=o,i++,i===t.length&&e()},o.onerror=()=>{console.error(`B\u0142\u0105d \u0142adowania grafiki dla: ${r} pod adresem ${s.image}`),i++,i===t.length&&e()}})}clearChunkCache(){this.chunkCache.clear()}static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var P=class n{seed=E(0);sizeX=E(1e3);sizeY=E(1e3);static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var $n=600*990,Yn=new Date("2026-01-01T00:00:00Z").getTime(),X=class n{realCurrentTimeMs=E(Date.now());dayOfYear=p(()=>Math.floor(this.gameDaysElapsed()%365));gameYear=p(()=>Math.floor(this.gameDaysElapsed()/365));timeOfDay=p(()=>this.gameDaysElapsed()%1);formattedTime=p(()=>{let e=Math.floor(this.timeOfDay()*24*60),t=Math.floor(e/60).toString().padStart(2,"0"),i=(e%60).toString().padStart(2,"0");return`${t}:${i}`});gameDaysElapsed=p(()=>{let e=this.realCurrentTimeMs()-Yn;return Math.max(0,e/$n)});tick(e=Date.now()){this.realCurrentTimeMs.set(e)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var k=class n{propertiesService=v(P);dayService=v(X);season=p(()=>{let e=this.dayService.dayOfYear();return e>=60&&e<152?"Wiosna":e>=152&&e<244?"Lato":e>=244&&e<335?"Jesie\u0144":"Zima"});sunElevation=p(()=>{let e=Math.sin((this.dayService.timeOfDay()-.25)*2*Math.PI),t=this.seasonFactor()*.2;return Math.max(-1,Math.min(1,e+t))});moonPhase=p(()=>this.dayService.gameDaysElapsed()/29.5%1);moonElevation=p(()=>{let e=(this.dayService.timeOfDay()-this.moonPhase()+1)%1;return Math.sin((e-.25)*2*Math.PI)});cloudiness=p(()=>{let e=this.weatherNoise(),t=this.seasonFactor()*-.3;return Math.max(0,Math.min(1,e+t))});rainPercentage=p(()=>{let e=this.cloudiness();if(e<.6)return 0;let t=this.season()==="Zima"||this.season()==="Jesie\u0144"?1.2:.5;return Math.min(1,(e-.6)/.4*t)});temperature=p(()=>{let e=21+this.seasonFactor()*11,i=6*Math.sin((this.dayService.timeOfDay()-.375)*2*Math.PI),r=this.sunElevation()>0?this.cloudiness()*-3:this.cloudiness()*2;return Math.round((e+i+r)*10)/10});humidity=p(()=>{let e=this.rainPercentage()*30,t=this.sunElevation()<0?10:0;return Math.max(0,Math.min(100,Math.round(55+e+t)))});sunBrightness=p(()=>{let e,t=this.sunElevation();if(t>0)e=t;else{let i=this.moonElevation();if(i>0){let r=1-Math.abs((this.moonPhase()-.5)*2);e=i*.1*r}else e=.02}return Math.max(0,Math.min(1,e))});brightness=p(()=>{let e=1-this.cloudiness()*.4;return Math.max(0,Math.min(1,this.sunBrightness()*e))});tideLevel=p(()=>{let e=.6+(1-Math.abs((this.moonPhase()-.5)*2))*.4;return Math.sin(this.dayService.gameDaysElapsed()*4*Math.PI-this.moonPhase()*2*Math.PI)*e});seasonFactor=p(()=>Math.sin((this.dayService.dayOfYear()-80)/365*2*Math.PI));weatherNoise=p(()=>{let e=this.propertiesService.seed(),t=Math.floor(this.dayService.gameDaysElapsed()),i=this.dayService.gameDaysElapsed()%1,r=K(e+t)(),s=K(e+t+1)();return r+(s-r)*i});static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var un=(n,e,t,i,r)=>{let s=(c,d)=>{let m=Math.max(0,Math.min(c,i)),h=Math.max(0,Math.min(d,r));return n[h][m].height},o=150*Math.PI/180,a=Math.cos(o),u=Math.sin(o),l=(c,d)=>{let m=s(c+1,d)-s(c-1,d),h=s(c,d+1)-s(c,d-1);return(m*a+h*u)*20};return{shadeTL:l(e,t),shadeTR:l(e+1,t),shadeBL:l(e,t+1),shadeBR:l(e+1,t+1)}};var nt=(n,e,t,i,r,s,o)=>{let a=r/32,u=(1-a)*o.shadeTL+a*o.shadeTR,l=(1-a)*o.shadeBL+a*o.shadeBR,c=(1-s)*u+s*l;if(Math.abs(c)>.01){let d=Math.min(Math.abs(c),1)*.5;n.globalCompositeOperation="overlay",n.fillStyle=c<0?`rgba(255, 255, 255, ${d})`:`rgba(0, 0, 0, ${d})`,n.fillRect(e,t,i,i),n.globalCompositeOperation="source-over"}};var hn=(n,e,t,i,r,s,o,a,u)=>{for(let l=0;l<32;l+=u){let c=Math.floor(r+l*s);if(c+o<0||c>n.height+1)continue;let d=l/32;for(let m=0;m<32;m+=u){let h=Math.floor(i+m*s);if(h+o<0||h>n.width+1)continue;let C=t[l][m];C&&(e.fillStyle=Me({height:C.height,isWater:C.isWater}),e.fillRect(h,c,o,o),nt(e,h,c,o,m,d,a))}}};var pn=(n,e,t,i,r,s,o,a,u,l)=>{for(let c=0;c<32;c++){let d=Math.floor(u+c*l);if(!(d+l*2<0||d>t.height+l))for(let m=0;m<32;m++){let h=Math.floor(a+m*l);if(h+l*2<0||h>t.width+l)continue;let C=r[c][m];if(!C?.plant)continue;let y=e.imageCache[C.plant],w=en(C.plant);if(y&&w){let D=s*32+m,S=o*32+c,_=K(n,D+100,S+100)()*.1*2-.1,A=w.imageScale??1,F=A+_*A,T=l*F,H=1+.2-F,L=K(n,D,S)(),ce=K(n,S,D)(),de=(L-.5)*l*H,ue=(ce-.5)*l*H,q=(l-T)/2,{isWater:oe}=C;oe&&(i.save(),i.globalAlpha=.4),i.drawImage(y,h+q+de,d+q+ue,T,T),oe&&i.restore()}}}};var fn=(n,e,t,i,r,s,o,a,u,l)=>{for(let c=0;c<32;c+=l){let d=Math.floor(s+c*o);if(d+o<0||d>e.height+1)continue;let m=c/32;for(let h=0;h<32;h+=l){let C=Math.floor(r+h*o);if(C+o<0||C>e.width+1)continue;let y=i[c][h];if(!y)continue;let w=y.isWater?"sea":ve(y.height),D=n.imageCache[w];D?t.drawImage(D,C,d,a,a):(t.fillStyle=Me({height:y.height,isWater:y.isWater}),t.fillRect(C,d,a,a)),nt(t,C,d,a,h,m,u)}}};var J=class n{cacheService=v(De);weatherService=v(k);propertiesService=v(P);terrain=E([]);cameraPos=E({posX:0,posY:0});zoomLevel=E(500);animationFrameId=E(null);regenerateMap(e,t){let i=t===this.propertiesService.seed()?Math.floor(Math.random()*1e9):t;this.propertiesService.seed.set(i),this.cacheService.clearChunkCache();let r=new tt({width:this.propertiesService.sizeX(),height:this.propertiesService.sizeY(),seed:this.propertiesService.seed(),scale:1,lacunarity:2,persistance:.45,octaves:6,lakeProbability:.5});this.terrain.set(r.generateMap()),this.centerCamera(e),this.drawViewport(e)}centerCamera(e){this.cameraPos.set({posX:this.propertiesService.sizeX()/2,posY:this.propertiesService.sizeY()/2}),this.zoomLevel.set(e.width/2)}drawViewport(e){let t=this.animationFrameId();t&&cancelAnimationFrame(t),this.animationFrameId.set(requestAnimationFrame(()=>{this.renderMainView(e)}))}renderMainView(e){let t=e.getContext("2d",{alpha:!1}),i=this.terrain();if(!t||!i.length)return;let{width:r,height:s}=e,o=this.zoomLevel(),a=this.cameraPos(),u=r/2,l=s/2;t.fillStyle="#0f172a",t.fillRect(0,0,r,s);let c=Math.floor(a.posX-u/o)-1,d=Math.floor(a.posX+u/o)+1,m=Math.floor(a.posY-l/o)-1,h=Math.floor(a.posY+l/o)+1,C=[],y=1;o<60?y=32:o<80?y=16:o<100?y=8:o<125?y=4:o<250&&(y=2);for(let f=m;f<=h;f++)if(!(f<0||f>=i.length))for(let _=c;_<=d;_++){if(_<0||_>=i[0].length)continue;let A=Math.floor((_-a.posX)*o+u),F=Math.floor((f-a.posY)*o+l);if(y<32){let T=this.renderDetailedChunkBase(e,t,_,f,A,F,o,y);T&&o>=400&&C.push({chunk:T,tx:_,ty:f,sX:A,sY:F,objSize:o/32})}else t.fillStyle=Me(i[f][_]),t.fillRect(A,F,Math.ceil(o),Math.ceil(o))}let w=this.propertiesService.seed();for(let f of C)pn(w,this.cacheService,e,t,f.chunk,f.tx,f.ty,f.sX,f.sY,f.objSize);let D=this.weatherService.brightness(),S=Math.max(0,(1-D)*.8);S>0&&(t.save(),t.globalCompositeOperation="multiply",t.fillStyle=`rgba(30, 40, 90, ${S})`,t.fillRect(0,0,e.width,e.height),t.globalCompositeOperation="source-over",t.fillStyle=`rgba(0, 0, 0, ${S*.3})`,t.fillRect(0,0,e.width,e.height),t.restore())}renderDetailedChunkBase(e,t,i,r,s,o,a,u){let l=this.terrain(),c=l.length-1,d=l[0].length-1,m=`${i}_${r}_${this.propertiesService.seed()}`,h=this.cacheService.chunkCache.get(m);if(!h){let f=l[r][i],_=i+1<=d?l[r][i+1]:f,A=r+1<=c?l[r+1][i]:f,F=r+1<=c&&i+1<=d?l[r+1][i+1]:_||A||f,T={tl:f,tr:_,bl:A,br:F};if(h=sn(this.propertiesService.seed(),i,r,T,32),this.cacheService.chunkCache.set(m,h),this.cacheService.chunkCache.size>1e3){let H=this.cacheService.chunkCache.keys().next().value;H&&this.cacheService.chunkCache.delete(H)}}let C=a/32,y=C*u,D=Math.ceil(y)+1,S=un(l,i,r,d,c);return a>=400?fn(this.cacheService,e,t,h,s,o,C,D,S,u):hn(e,t,h,s,o,C,D,S,u),h}static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var qn=["minimapCanvas"],it=class n{gameService=v(J);propertiesService=v(P);positionChange=Ye();minimapCanvasRef=Xe.required("minimapCanvas");expanded=E(!0);minimapCanvas=E(null);constructor(){Ee(()=>{this.setMinimapCanvas()}),Ee(()=>{this.drawMinimapMarker()})}onMinimapClick(e){let t=e.target,i=Math.round(e.offsetX/t.clientWidth*this.propertiesService.sizeX()),r=Math.round(e.offsetY/t.clientHeight*this.propertiesService.sizeY());this.gameService.cameraPos.set({posX:i,posY:r}),this.positionChange.emit()}toggleExpanded(){this.expanded.set(!this.expanded())}setMinimapCanvas(){let e=document.createElement("canvas");rn(e,this.gameService.terrain()),this.minimapCanvas.set(e);let t=this.minimapCanvasRef().nativeElement;t.width=this.propertiesService.sizeX(),t.height=this.propertiesService.sizeY()}drawMinimapMarker(){let e=this.minimapCanvasRef().nativeElement,t=this.minimapCanvas(),i=this.gameService.cameraPos();on(e,t,i.posX,i.posY)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=I({type:n,selectors:[["minimap"]],viewQuery:function(t,i){t&1&&Ue(i.minimapCanvasRef,qn,5),t&2&&ze()},outputs:{positionChange:"positionChange"},decls:5,vars:2,consts:[["minimapCanvas",""],[1,"overflow-hidden","transition-all","cursor-crosshair",3,"ngClass"],[1,"absolute","top-3","right-3","cursor-pointer",3,"click"],[1,"text-white",3,"ngClass"],[1,"block","rounded","object-contain","size-full",3,"click"]],template:function(t,i){if(t&1){let r=Ce();b(0,"div",1)(1,"div",2),G("click",function(){return R(r),B(i.toggleExpanded())}),$(2,"div",3),M(),b(3,"canvas",4,0),G("click",function(o){return R(r),B(i.onMinimapClick(o))}),M()()}t&2&&(V("ngClass",i.expanded()?"rounded-4xl size-96":"rounded-2xl size-40"),g(2),V("ngClass",i.expanded()?"svg-collapse text-2xl":"svg-expand text-xl"))},dependencies:[j,qe],encapsulation:2})};var Zn=5,Kn=1e4,rt=class n{gameService=v(J);propertiesService=v(P);isDragging=E(!1);lastMousePos=E({posX:0,posY:0});onMouseDown(e){this.isDragging.set(!0),this.lastMousePos.set({posX:e.clientX,posY:e.clientY})}onMouseUp(){this.isDragging.set(!1)}onMouseMove(e,t){if(!this.isDragging())return;let i=e.clientX-this.lastMousePos().posX,r=e.clientY-this.lastMousePos().posY;this.lastMousePos.set({posX:e.clientX,posY:e.clientY});let s=i/this.gameService.zoomLevel(),o=r/this.gameService.zoomLevel();this.gameService.cameraPos.update(a=>({posX:Math.max(0,Math.min(this.propertiesService.sizeX(),a.posX-s)),posY:Math.max(0,Math.min(this.propertiesService.sizeY(),a.posY-o))})),this.gameService.drawViewport(t)}onWheel(e,t){e.preventDefault();let i=.1,r=e.deltaY>0?-1:1,s=this.gameService.zoomLevel()*(1+r*i);s=Math.max(Zn,Math.min(Kn,s)),this.gameService.zoomLevel.set(s),this.gameService.drawViewport(t)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var Vn=(()=>{class n{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,i){this._renderer=t,this._elementRef=i}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(i){return new(i||n)(z(Mt),z(Ct))};static \u0275dir=Z({type:n})}return n})(),Sn=(()=>{class n extends Vn{static \u0275fac=(()=>{let t;return function(r){return(t||(t=be(n)))(r||n)}})();static \u0275dir=Z({type:n,features:[te]})}return n})(),Tt=new _e("");var Qn={provide:Tt,useExisting:he(()=>ct),multi:!0};function Jn(){let n=Vt()?Vt().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var ei=new _e(""),ct=(()=>{class n extends Vn{_compositionMode;_composing=!1;constructor(t,i,r){super(t,i),this._compositionMode=r,this._compositionMode==null&&(this._compositionMode=!Jn())}writeValue(t){let i=t??"";this.setProperty("value",i)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(i){return new(i||n)(z(Mt),z(Ct),z(ei,8))};static \u0275dir=Z({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){i&1&&G("input",function(o){return r._handleInput(o.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(o){return r._compositionEnd(o.target.value)})},standalone:!1,features:[fe([Qn]),te]})}return n})();function ti(n){return n==null||ni(n)===0}function ni(n){return n==null?null:Array.isArray(n)||typeof n=="string"?n.length:n instanceof Set?n.size:null}var dt=new _e(""),ii=new _e("");function ri(n){return e=>{if(e.value==null||n==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function oi(n){return e=>{if(e.value==null||n==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function si(n){return ti(n.value)?{required:!0}:null}function vn(n){return null}function En(n){return n!=null}function An(n){return Yt(n)?Ut(n):n}function xn(n){let e={};return n.forEach(t=>{e=t!=null?W(W({},e),t):e}),Object.keys(e).length===0?null:e}function Fn(n,e){return e.map(t=>t(n))}function ai(n){return!n.validate}function In(n){return n.map(e=>ai(e)?e:t=>e.validate(t))}function li(n){if(!n)return null;let e=n.filter(En);return e.length==0?null:function(t){return xn(Fn(t,e))}}function Nn(n){return n!=null?li(In(n)):null}function ci(n){if(!n)return null;let e=n.filter(En);return e.length==0?null:function(t){let i=Fn(t,e).map(An);return $t(i).pipe(zt(xn))}}function Pn(n){return n!=null?ci(In(n)):null}function yn(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function di(n){return n._rawValidators}function ui(n){return n._rawAsyncValidators}function Ft(n){return n?Array.isArray(n)?n:[n]:[]}function st(n,e){return Array.isArray(n)?n.includes(e):n===e}function _n(n,e){let t=Ft(e);return Ft(n).forEach(r=>{st(t,r)||t.push(r)}),t}function bn(n,e){return Ft(e).filter(t=>!st(n,t))}var at=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Nn(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Pn(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},It=class extends at{name;get formDirective(){return null}get path(){return null}},Te=class extends at{_parent=null;name=null;valueAccessor=null},Nt=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}};var kn=(()=>{class n extends Nt{constructor(t){super(t)}static \u0275fac=function(i){return new(i||n)(z(Te,2))};static \u0275dir=Z({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){i&2&&Xt("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[te]})}return n})();var Ie="VALID",ot="INVALID",we="PENDING",Ne="DISABLED",ye=class{},lt=class extends ye{value;source;constructor(e,t){super(),this.value=e,this.source=t}},Pe=class extends ye{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},ke=class extends ye{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},Ve=class extends ye{status;source;constructor(e,t){super(),this.status=e,this.source=t}};var Pt=class extends ye{source;constructor(e){super(),this.source=e}};function hi(n){return(ut(n)?n.validators:n)||null}function mi(n){return Array.isArray(n)?Nn(n):n||null}function pi(n,e){return(ut(e)?e.asyncValidators:n)||null}function fi(n){return Array.isArray(n)?Pn(n):n||null}function ut(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}var kt=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return me(this.statusReactive)}set status(e){me(()=>this.statusReactive.set(e))}_status=p(()=>this.statusReactive());statusReactive=E(void 0);get valid(){return this.status===Ie}get invalid(){return this.status===ot}get pending(){return this.status==we}get disabled(){return this.status===Ne}get enabled(){return this.status!==Ne}errors;get pristine(){return me(this.pristineReactive)}set pristine(e){me(()=>this.pristineReactive.set(e))}_pristine=p(()=>this.pristineReactive());pristineReactive=E(!0);get dirty(){return!this.pristine}get touched(){return me(this.touchedReactive)}set touched(e){me(()=>this.touchedReactive.set(e))}_touched=p(()=>this.touchedReactive());touchedReactive=E(!1);get untouched(){return!this.touched}_events=new Wt;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(_n(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(_n(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(bn(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(bn(e,this._rawAsyncValidators))}hasValidator(e){return st(this._rawValidators,e)}hasAsyncValidator(e){return st(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(ee(W({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new ke(!0,i))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:i})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,i),t&&e.emitEvent!==!1&&this._events.next(new ke(!1,i))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(ee(W({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new Pe(!1,i))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,i),t&&e.emitEvent!==!1&&this._events.next(new Pe(!0,i))}markAsPending(e={}){this.status=we;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Ve(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(ee(W({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ne,this.errors=null,this._forEachChild(r=>{r.disable(ee(W({},e),{onlySelf:!0}))}),this._updateValue();let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new lt(this.value,i)),this._events.next(new Ve(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(ee(W({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ie,this._forEachChild(i=>{i.enable(ee(W({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(ee(W({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ie||this.status===we)&&this._runAsyncValidator(i,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new lt(this.value,t)),this._events.next(new Ve(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(ee(W({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ne:Ie}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=we,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:e!==!1};let i=An(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((i,r)=>i&&i._find(r),this)}getError(e,t){let i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,i){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||i)&&this._events.next(new Ve(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,i)}_initObservables(){this.valueChanges=new Be,this.statusChanges=new Be}_calculateStatus(){return this._allControlsDisabled()?Ne:this.errors?ot:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(we)?we:this._anyControlsHaveStatus(ot)?ot:Ie}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),r&&this._events.next(new Pe(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new ke(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ut(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=mi(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=fi(this._rawAsyncValidators)}};var Tn=new _e("",{factory:()=>Ot}),Ot="always";function gi(n,e){return[...e.path,n]}function vi(n,e,t=Ot){_i(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),bi(n,e),Mi(n,e),Ci(n,e),yi(n,e)}function Cn(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function yi(n,e){if(e.valueAccessor.setDisabledState){let t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function _i(n,e){let t=di(n);e.validator!==null?n.setValidators(yn(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let i=ui(n);e.asyncValidator!==null?n.setAsyncValidators(yn(i,e.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();Cn(e._rawValidators,r),Cn(e._rawAsyncValidators,r)}function bi(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&On(n,e)})}function Ci(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&On(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function On(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Mi(n,e){let t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function Di(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function wi(n){return Object.getPrototypeOf(n.constructor)===Sn}function Vi(n,e){if(!e)return null;Array.isArray(e);let t,i,r;return e.forEach(s=>{s.constructor===ct?t=s:wi(s)?i=s:r=s}),r||i||t||null}function Mn(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Dn(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Si=class extends kt{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,i){super(hi(t),pi(i,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ut(t)&&(t.nonNullable||t.initialValueIsDefault)&&(Dn(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),t.overwriteDefaultValue&&(this.defaultValue=this.value),this._pendingChange=!1,t?.emitEvent!==!1&&this._events.next(new Pt(this))}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Mn(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Mn(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Dn(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Ei={provide:Te,useExisting:he(()=>Rt)},wn=Promise.resolve(),Rt=(()=>{class n extends Te{_changeDetectorRef;callSetDisabledState;control=new Si;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Be;constructor(t,i,r,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this._parent=t,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=Vi(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let i=t.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),Di(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){vi(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){wn.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let i=t.isDisabled.currentValue,r=i!==0&&wt(i);wn.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?gi(t,this._parent):[t]}static \u0275fac=function(i){return new(i||n)(z(It,9),z(dt,10),z(ii,10),z(Tt,10),z(Jt,8),z(Tn,8))};static \u0275dir=Z({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[fe([Ei]),te,bt]})}return n})();var Ai={provide:Tt,useExisting:he(()=>Bt),multi:!0},Bt=(()=>{class n extends Sn{writeValue(t){let i=t??"";this.setProperty("value",i)}registerOnChange(t){this.onChange=i=>{t(i==""?null:parseFloat(i))}}static \u0275fac=(()=>{let t;return function(r){return(t||(t=be(n)))(r||n)}})();static \u0275dir=Z({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,r){i&1&&G("input",function(o){return r.onChange(o.target.value)})("blur",function(){return r.onTouched()})},standalone:!1,features:[fe([Ai]),te]})}return n})();function Rn(n){return typeof n=="number"?n:parseFloat(n)}var Gt=(()=>{class n{_validator=vn;_onChange;_enabled;ngOnChanges(t){if(this.inputName in t){let i=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):vn,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Z({type:n,features:[bt]})}return n})(),xi={provide:dt,useExisting:he(()=>jt),multi:!0},jt=(()=>{class n extends Gt{max;inputName="max";normalizeInput=t=>Rn(t);createValidator=t=>oi(t);static \u0275fac=(()=>{let t;return function(r){return(t||(t=be(n)))(r||n)}})();static \u0275dir=Z({type:n,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&Ge("max",r._enabled?r.max:null)},inputs:{max:"max"},standalone:!1,features:[fe([xi]),te]})}return n})(),Fi={provide:dt,useExisting:he(()=>Ht),multi:!0},Ht=(()=>{class n extends Gt{min;inputName="min";normalizeInput=t=>Rn(t);createValidator=t=>ri(t);static \u0275fac=(()=>{let t;return function(r){return(t||(t=be(n)))(r||n)}})();static \u0275dir=Z({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&Ge("min",r._enabled?r.min:null)},inputs:{min:"min"},standalone:!1,features:[fe([Fi]),te]})}return n})(),Ii={provide:dt,useExisting:he(()=>Lt),multi:!0};var Lt=(()=>{class n extends Gt{required;inputName="required";normalizeInput=wt;createValidator=t=>si;enabled(t){return t}static \u0275fac=(()=>{let t;return function(r){return(t||(t=be(n)))(r||n)}})();static \u0275dir=Z({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,r){i&2&&Ge("required",r._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[fe([Ii]),te]})}return n})();var Ni=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=Dt({type:n});static \u0275inj=_t({})}return n})();var Bn=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:Tn,useValue:t.callSetDisabledState??Ot}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Dt({type:n});static \u0275inj=_t({imports:[Ni]})}return n})();var jn=3e3,Gn=Y.sea.threshold*jn,ht=class n{propertiesService=v(P);gameService=v(J);regenerate=Ye();newSeed=E(0);pointHeight=p(()=>{let{posX:e,posY:t}=this.gameService.cameraPos();return(this.gameService.terrain()?.[Math.round(t)]?.[Math.round(e)]?.height??0)*(jn+Gn)-Gn});constructor(){Ee(()=>{this.newSeed.set(this.propertiesService.seed())})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=I({type:n,selectors:[["info"]],outputs:{regenerate:"regenerate"},decls:19,vars:21,consts:[["seedInput",""],[1,"size-full","p-4","shadow-xl","pointer-events-auto"],[1,"flex","flex-col","gap-2"],[1,"text-xs","text-slate-400","font-mono","mt-1","space-y-1"],["type","number",1,"bg-slate-800","text-slate-200","p-1","rounded","w-24","text-center",3,"ngModelChange","required","min","max","ngModel"],[1,"px-4","py-2","bg-indigo-600","hover:bg-indigo-500","text-white","rounded-lg","transition","cursor-pointer","shadow-lg","active:scale-95","disabled:pointer-events-none","disabled:opacity-30",3,"click","disabled"]],template:function(t,i){if(t&1){let r=Ce();b(0,"div",1)(1,"div",2)(2,"div",3)(3,"div"),x(4," Seed: "),b(5,"input",4,0),Kt("ngModelChange",function(o){return R(r),Zt(i.newSeed,o)||(i.newSeed=o),B(o)}),M()(),b(7,"div"),x(8),se(9,"number"),se(10,"number"),M(),b(11,"div"),x(12),se(13,"number"),M(),b(14,"div"),x(15),se(16,"number"),M()(),b(17,"button",5),G("click",function(){return R(r),B(i.regenerate.emit(i.newSeed()))}),x(18," Generuj "),M()()()}if(t&2){let r=pe(6);g(5),V("required",!0)("min",0)("max",999999999),qt("ngModel",i.newSeed),g(3),$e(" Pozycja: ",ae(9,9,i.gameService.cameraPos().posX,"1.0-0")," x ",ae(10,12,i.gameService.cameraPos().posY,"1.0-0")," "),g(4),ie("Zoom: ",ae(13,15,i.gameService.zoomLevel(),"1.0-0")),g(3),ie("Wysoko\u015B\u0107: ",ae(16,18,i.pointHeight(),"1.0-0")," m n.p.m."),g(2),V("disabled",!r.validity.valid)}},dependencies:[j,Bn,ct,Bt,kn,Lt,Ht,jt,Rt,Ke],encapsulation:2})};var Oe=(n,e,t,i)=>{let r=Math.round(n[0]+(e[0]-n[0])*t),s=Math.round(n[1]+(e[1]-n[1])*t),o=Math.round(n[2]+(e[2]-n[2])*t);return i===void 0?`rgb(${r}, ${s}, ${o})`:`rgba(${r}, ${s}, ${o}, ${i})`};var Re=n=>({"background-color":n}),mt=class n{weather=v(k);cloudRGB=p(()=>Oe([92,92,92],[217,217,217],this.weather.brightness(),this.weather.cloudiness()));static \u0275fac=function(t){return new(t||n)};static \u0275cmp=I({type:n,selectors:[["clouds"]],decls:7,vars:15,consts:[[1,"animate-cloud-left"],[1,"absolute","top-12","left-[-20%]","w-80","h-24","rounded-full","blur-2xl","transition-colors","duration-1000","ease-linear",3,"ngStyle"],[1,"absolute","top-32","left-[10%]","w-100","h-32","rounded-full","blur-2xl","transition-colors","duration-1000","ease-linear",3,"ngStyle"],[1,"absolute","top-0","left-[10%]","w-96","h-28","rounded-full","blur-2xl","transition-colors","duration-1000","ease-linear",3,"ngStyle"],[1,"animate-cloud-right"],[1,"absolute","top-0","left-[-10%]","w-96","h-40","rounded-full","blur-2xl","transition-colors","duration-1000","ease-linear",3,"ngStyle"]],template:function(t,i){t&1&&(b(0,"div",0),$(1,"div",1)(2,"div",2)(3,"div",3),M(),b(4,"div",4),$(5,"div",5)(6,"div",2),M()),t&2&&(g(),V("ngStyle",re(5,Re,i.cloudRGB())),g(),V("ngStyle",re(7,Re,i.cloudRGB())),g(),V("ngStyle",re(9,Re,i.cloudRGB())),g(2),V("ngStyle",re(11,Re,i.cloudRGB())),g(),V("ngStyle",re(13,Re,i.cloudRGB())))},dependencies:[j,Ze],encapsulation:2})};function ki(n,e){if(n&1&&ne(0,"div",1),n&2){let t=e.$implicit;Q("left",t.left)("animation-duration",t.duration)("animation-delay",t.delay)("opacity",t.opacity)}}var pt=class n{weather=v(k);rainDrops=p(()=>{let e=this.weather.rainPercentage()*100,t=Math.floor(e*2);return Array.from({length:t}).map(()=>({left:`${Math.random()*100}%`,duration:`${1.1-e/100}s`,opacity:.1+Math.random()*.5,delay:`${Math.random()*2}s`}))});static \u0275fac=function(t){return new(t||n)};static \u0275cmp=I({type:n,selectors:[["rain"]],decls:2,vars:0,consts:[[1,"absolute","bg-blue-100","w-px","h-5","bottom-full","animate-fall",3,"left","animation-duration","animation-delay","opacity"],[1,"absolute","bg-blue-100","w-px","h-5","bottom-full","animate-fall"]],template:function(t,i){t&1&&He(0,ki,1,8,"div",0,je),t&2&&Le(i.rainDrops())},encapsulation:2})};var ft=class n{dayService=v(X);weather=v(k);skyRGB=Qt.required();moonX=p(()=>(this.dayService.timeOfDay()-this.weather.moonPhase()+1)%1*150-25);moonY=p(()=>-(this.weather.moonElevation()-1)*55+5);shadowTransform=p(()=>{let e=this.weather.moonPhase(),t,i=105;return e<=.5?t=-(e*2)*i:t=(1-e)*2*i,`translateX(${t}%)`});static \u0275fac=function(t){return new(t||n)};static \u0275cmp=I({type:n,selectors:[["moon"]],inputs:{skyRGB:[1,"skyRGB"]},decls:10,vars:8,consts:[[1,"absolute","size-12","rounded-full","transition-all","duration-1000","ease-linear","z-10","overflow-hidden"],[1,"absolute","inset-1","bg-slate-100","rounded-full","overflow-hidden","size-10","shadow-[0_0_3px_1px","rgba(255,","255,","255,","0.5)]"],[1,"absolute","inset-0","opacity-10","bg-[radial-gradient(circle_at_60%_60%,#94a3b8_0%,transparent_50%)]"],[1,"absolute","top-[60%]","left-[25%]","size-3","rounded-full","bg-slate-300/40","shadow-[inset_1px_1px_2px_rgba(0,0,0,0.1)]","blur-[0.5px]"],[1,"absolute","top-[30%]","left-[55%]","size-2","rounded-full","bg-slate-300/30","shadow-[inset_-1px_-1px_1px_rgba(0,0,0,0.1)]"],[1,"absolute","top-[20%]","left-[30%]","size-1.5","rounded-full","bg-slate-400/20"],[1,"absolute","top-[60%]","left-[60%]","size-1","rounded-full","bg-slate-400/25"],[1,"absolute","top-[45%]","left-[15%]","size-2.5","rounded-full","bg-slate-300/30","blur-[0.2px]"],[1,"absolute","top-[15%]","left-[45%]","w-5","h-3","rotate-[-20deg]","rounded-full","bg-slate-400/10","blur-md"],[1,"absolute","inset-0","rounded-full","transition-all","duration-1000","ease-linear","z-20","blur-xs","size-12"]],template:function(t,i){t&1&&(We(0,"div",0)(1,"div",1),ne(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8),Ae(),ne(9,"div",9),Ae()),t&2&&(Q("left",i.moonX(),"%")("top",i.moonY(),"%"),g(9),Q("background-color",i.skyRGB())("transform",i.shadowTransform()))},dependencies:[j],encapsulation:2})};var gt=class n{dayService=v(X);weather=v(k);sunX=p(()=>this.dayService.timeOfDay()*150-25);sunY=p(()=>-(this.weather.sunElevation()-1)*55+5);static \u0275fac=function(t){return new(t||n)};static \u0275cmp=I({type:n,selectors:[["sun"]],decls:1,vars:4,consts:[[1,"absolute","-ml-7","w-14","h-14","bg-[#f6bb42]","rounded-full","shadow-[0_0_30px_#f6bb42]","transition-all","duration-1000","ease-linear"]],template:function(t,i){t&1&&ne(0,"div",0),t&2&&Q("left",i.sunX(),"%")("top",i.sunY(),"%")},encapsulation:2})};function Ti(n,e){if(n&1&&ne(0,"div",2),n&2){let t=e.$implicit;Q("left",t.posX,"%")("top",t.posY,"%")("width",t.size,"px")("height",t.size,"px")("animation-duration",t.duration,"s")}}var vt=class n{weather=v(k);propertiesService=v(P);stars=p(()=>{let e=this.propertiesService.seed(),t=[];for(let i=0;i<100;i++){let r=Math.sin(e+i)*1e4%100,s=Math.cos(e+i*2)*1e4%75,o=Math.abs(Math.sin(e-i)*3),a=3+Math.abs(Math.sin(i)*12);t.push({posX:Math.abs(r),posY:Math.abs(s),size:o,duration:a})}return t});starsOpacity=p(()=>{let e=this.weather.brightness();return Math.max(0,1-e*3.3)});static \u0275fac=function(t){return new(t||n)};static \u0275cmp=I({type:n,selectors:[["stars"]],decls:3,vars:2,consts:[[1,"absolute","inset-0","z-0","pointer-events-none","transition-opacity","duration-1000"],[1,"absolute","bg-white","rounded-full","animate-twinkle",3,"left","top","width","height","animation-duration"],[1,"absolute","bg-white","rounded-full","animate-twinkle"]],template:function(t,i){t&1&&(We(0,"div",0),He(1,Ti,1,10,"div",1,je),Ae()),t&2&&(Q("opacity",i.starsOpacity()),g(),Le(i.stars()))},dependencies:[j],encapsulation:2})};var Hn=n=>({"background-color":n}),yt=class n{weatherService=v(k);dayService=v(X);skyRGB=p(()=>Oe([15,23,42],[56,139,255],this.weatherService.brightness()));grassRGB=p(()=>Oe([50,60,42],[100,160,62],this.weatherService.brightness(),.6));expanded=E(!0);toggleExpanded(){this.expanded.set(!this.expanded())}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=I({type:n,selectors:[["weather"]],decls:56,vars:34,consts:[[1,"overflow-hidden","bg-slate-900","cursor-pointer","transition-all",3,"click","ngClass"],[1,"size-full","relative","shadow-2xl","duration-1000","ease-linear","transition-colors",3,"ngStyle"],[1,"absolute","inset-x-0","top-0","w-full","transition-all","z-0",3,"ngClass"],[1,"relative","size-full","block"],[1,"relative","size-full","block",3,"skyRGB"],[1,"relative","w-full","min-h-96"],[1,"absolute","inset-0","pointer-events-none","z-10"],[1,"absolute","inset-0","pointer-events-none","overflow-hidden","z-50"],[1,"absolute","inset-0","z-30","flex","flex-col","justify-between","pointer-events-none"],[1,"flex","justify-end","drop-shadow-md","text-white","transition-all","px-6",3,"ngClass"],[1,"absolute","left-6"],[1,"font-bold","tracking-tighter","transition-all",3,"ngClass"],[1,"flex","gap-6","justify-between","font-light","text-center"],[1,"transition-all",3,"ngClass"],[1,"text-xl"],[1,"text-sm"],[1,"text-sm","transition-all",3,"ngClass"],[1,"backdrop-blur-xl","p-6","text-white","drop-shadow-lg","pointer-events-auto","transition-colors","duration-1000","ease-linear","flex","flex-col","gap-4",3,"ngStyle"],[1,"flex","justify-between","items-center"],[1,"text-lg","font-medium"],[1,"inline-block","mt-2","px-4","py-1","bg-white/20","rounded-full","text-sm","font-semibold","backdrop-blur-md","border","border-white/10","shadow-sm"],[1,"grid","grid-cols-3"],[1,"flex","flex-col","items-center"],[1,"text-xs","uppercase","opacity-70","mb-1","font-semibold","tracking-wider"],[1,"font-bold","text-xl"],[1,"font-bold","text-xl","text-blue-400"]],template:function(t,i){t&1&&(b(0,"div",0),G("click",function(){return i.toggleExpanded()}),b(1,"div",1)(2,"div",2),$(3,"sun",3),M(),b(4,"div",2),$(5,"moon",4),M(),b(6,"div",5),$(7,"stars"),M(),$(8,"clouds",6)(9,"rain",7),b(10,"div",8)(11,"div",9)(12,"div",10)(13,"h1",11),x(14),M()(),b(15,"div",12)(16,"div",13)(17,"div",14),x(18),M(),b(19,"div",15),x(20,"Rok"),M()(),b(21,"div",13)(22,"div",14),x(23),M(),b(24,"div",15),x(25,"Dzie\u0144"),M()(),b(26,"div")(27,"div",13),x(28),M(),b(29,"div",16),x(30),M()()()(),b(31,"div",13)(32,"div",17)(33,"div",18)(34,"p",19),x(35),M(),b(36,"span",20),x(37),M()(),b(38,"div",21)(39,"div",22)(40,"span",23),x(41,"Wilgotno\u015B\u0107"),M(),b(42,"span",24),x(43),M()(),b(44,"div",22)(45,"span",23),x(46,"Chmury"),M(),b(47,"span",24),x(48),se(49,"number"),M()(),b(50,"div",22)(51,"span",23),x(52,"Opady"),M(),b(53,"span",25),x(54),se(55,"number"),M()()()()()()()()),t&2&&(V("ngClass",i.expanded()?"rounded-4xl size-96":"rounded-2xl h-20 w-96"),g(),V("ngStyle",re(30,Hn,i.skyRGB())),g(),V("ngClass",i.expanded()?"h-96":"h-40"),g(2),V("ngClass",i.expanded()?"h-96":"h-40"),g(),V("skyRGB",i.skyRGB()),g(6),V("ngClass",i.expanded()?"py-6":"py-4"),g(2),V("ngClass",i.expanded()?"text-6xl":"text-5xl"),g(),xe(i.dayService.formattedTime()),g(2),V("ngClass",i.expanded()?"opacity-0":"opacity-100"),g(2),xe(i.dayService.gameYear()),g(3),V("ngClass",i.expanded()?"opacity-0":"opacity-100"),g(2),xe(i.dayService.dayOfYear()),g(4),V("ngClass",i.expanded()?"text-5xl":"text-xl"),g(),ie("",i.weatherService.temperature(),"\xB0C"),g(),V("ngClass",i.expanded()?"opacity-0":"opacity-100"),g(),xe(i.weatherService.season()),g(),V("ngClass",i.expanded()?"opacity-100":"opacity-0"),g(),V("ngStyle",re(32,Hn,i.grassRGB())),g(3),$e("Rok ",i.dayService.gameYear(),", Dzie\u0144 ",i.dayService.dayOfYear()),g(2),ie(" ",i.weatherService.season()," "),g(6),ie("",i.weatherService.humidity(),"%"),g(5),ie("",ae(49,24,i.weatherService.cloudiness()*100,"1.0-0"),"%"),g(6),ie("",ae(55,27,i.weatherService.rainPercentage()*100,"1.0-0"),"%"))},dependencies:[j,qe,Ze,mt,pt,ft,gt,vt,Ke],encapsulation:2})};var Oi=["mainCanvas"],Ln=class n{mouseService=v(rt);gameService=v(J);cacheService=v(De);dayService=v(X);propertiesService=v(P);mainCanvasRef=Xe.required("mainCanvas");tickInterval;constructor(){this.cacheService.preloadImages(()=>{this.gameService.drawViewport(this.mainCanvasRef().nativeElement)}),this.tickInterval=setInterval(()=>{this.dayService.tick(),this.gameService.drawViewport(this.mainCanvasRef().nativeElement)},1e3)}ngAfterViewInit(){this.resizeMainCanvas(),window.addEventListener("resize",()=>{this.resizeMainCanvas(),this.gameService.drawViewport(this.mainCanvasRef().nativeElement)}),this.gameService.regenerateMap(this.mainCanvasRef().nativeElement,this.propertiesService.seed())}ngOnDestroy(){clearInterval(this.tickInterval)}resizeMainCanvas(){let e=this.mainCanvasRef().nativeElement;e.width=window.innerWidth,e.height=window.innerHeight}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=I({type:n,selectors:[["game-page"]],viewQuery:function(t,i){t&1&&Ue(i.mainCanvasRef,Oi,5),t&2&&ze()},decls:6,vars:0,consts:[["mainCanvas",""],[1,"relative","w-full","h-screen","bg-slate-900","overflow-hidden","select-none","font-sans"],[1,"absolute","inset-0","z-0","cursor-crosshair","active:cursor-grabbing",3,"mousedown","mousemove","mouseup","mouseleave","wheel"],[1,"absolute","top-4","left-4","z-10"],[1,"absolute","top-4","right-4","z-20",3,"positionChange"],[1,"absolute","bottom-4","left-4","z-10","rounded-2xl","w-60","overflow-hidden","bg-slate-900",3,"regenerate"]],template:function(t,i){if(t&1){let r=Ce();b(0,"div",1)(1,"canvas",2,0),G("mousedown",function(o){return R(r),B(i.mouseService.onMouseDown(o))})("mousemove",function(o){R(r);let a=pe(2);return B(i.mouseService.onMouseMove(o,a))})("mouseup",function(){return R(r),B(i.mouseService.onMouseUp())})("mouseleave",function(){return R(r),B(i.mouseService.onMouseUp())})("wheel",function(o){R(r);let a=pe(2);return B(i.mouseService.onWheel(o,a))}),M(),$(3,"weather",3),b(4,"minimap",4),G("positionChange",function(){R(r);let o=pe(2);return B(i.gameService.drawViewport(o))}),M(),b(5,"info",5),G("regenerate",function(o){R(r);let a=pe(2);return B(i.gameService.regenerateMap(a,o))}),M()()}},dependencies:[j,it,ht,yt],encapsulation:2})};export{Ln as GamePage};
