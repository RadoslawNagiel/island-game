import{a as Je,b as Y,c as ge,d as ve,h as et,i as tn}from"./chunk-AIT3MMXB.js";import{$a as Q,Aa as ne,Ab as Ke,Bb as Qe,Ca as Xt,Db as L,Fa as je,G as he,H as U,I as _t,Ia as He,K as _e,Ka as Le,La as We,M as g,Ma as S,Na as _,Oa as C,Pa as $,Qa as Ue,R as G,Ra as xe,S as j,Sa as ie,Ta as Ce,Va as H,X as Ge,Ya as ze,Za as $e,_a as pe,a as W,aa as E,ab as qt,b as te,ba as Ae,bb as F,ca as me,cb as Fe,da as bt,db as re,ea as be,eb as Ye,f as Ut,fa as Ct,fb as Zt,gb as Kt,hb as Qt,i as zt,ib as fe,jb as oe,kb as ae,mb as le,n as $t,na as f,ob as p,pb as Xe,qb as Jt,rb as qe,s as Yt,sa as Mt,sb as en,ta as z,ub as wt,vb as Vt,xa as P,ya as Dt,za as Z,zb as Ze}from"./chunk-UM4DY465.js";function nn(n,e,t,i,r){let s=n[t][Math.min(i-1,e+1)].height-n[t][Math.max(0,e-1)].height,o=n[Math.min(r-1,t+1)][e].height-n[Math.max(0,t-1)][e].height,a=.5+(s-o)*20;return Math.max(.3,Math.min(1.4,a))}var St=(n,e,t)=>n+(e-n)*t,rn=(n,e,t)=>[Math.round(St(n[0],e[0],t)),Math.round(St(n[1],e[1],t)),Math.round(St(n[2],e[2],t))];var Et=(n,e)=>{let t=Math.max(0,Math.min(1,n.height)),i=e===void 0?void 0:ge("sea").threshold+(1+e)*.0015,r=ve(t,i),s=ge(r),o=Object.values(Je),a=o.findIndex(h=>h===r)-1,u=a>=0?ge(o[a]).threshold??1:0,l=(t-u)/(s.threshold-u),c=ge("sea"),d=n.isWater?c.colorFrom:s.colorFrom,m=n.isWater?c.colorTo:s.colorTo;return rn(d,m,l)},Me=(n,e)=>{let[t,i,r]=Et(n,e);return`rgb(${t},${i},${r})`};var on=(n,e,t)=>{let i=e.length,r=e[0]?.length??0;if(!r||!i)return;n.width=r,n.height=i;let s=n.getContext("2d");if(!s)return;let o=s.createImageData(r,i),{data:a}=o,u=0;for(let l=0;l<i;l++){let c=e[l];for(let d=0;d<r;d++){let[m,h,b]=Et(c[d],t),v=nn(e,d,l,r,i);a[u++]=Math.min(255,m*v),a[u++]=Math.min(255,h*v),a[u++]=Math.min(255,b*v),a[u++]=255}}s.putImageData(o,0,0)};var At={radius:5,width:4,color:"#ff265c"};function sn(n,e,t,i){let r=n.getContext("2d");!r||!e||(r.clearRect(0,0,n.width,n.height),r.drawImage(e,0,0),r.beginPath(),r.arc(t,i,At.radius,0,Math.PI*2),r.lineWidth=At.width,r.strokeStyle=At.color,r.stroke(),r.closePath())}var K=(n,e,t)=>()=>{let i=n+++(e??0)*374761393+(t??0)*668265263,r=Math.sin(i)*1e4;return r-Math.floor(r)};var Wn=(n,e)=>{let t=ge(n).plantDensity??0;if(e()>t)return null;let i=Object.entries(et).filter(([,a])=>a.locations.some(u=>u.location===n));if(i.length===0)return null;let r=i.map(([,a])=>a.locations.find(u=>u.location===n).probability),s=r.reduce((a,u)=>a+u,0);if(s<=0)return null;let o=e()*s;for(let a=0;a<i.length;a++){if(o<r[a])return i[a][0];o-=r[a]}return null},an=(n,e,t,i,r=32)=>{let s=Array.from({length:r},()=>new Array(r)),o=n+e*73856+t*19349,a=K(o);for(let u=0;u<r;u++)for(let l=0;l<r;l++){let c=l/r,d=u/r,m=(1-c)*i.tl.height+c*i.tr.height,h=(1-c)*i.bl.height+c*i.br.height,b=(1-d)*m+d*h,v=Math.max(0,Math.min(1,b)),w=ve(v),x=Object.values(i).filter(M=>M.isWater).find(M=>w===ve(M.height));w!=="sea"&&x&&(w="inlandWaters");let V=Wn(w,a);s[u][l]={height:v,isWater:w==="inlandWaters"||w==="sea",biome:w,plant:V}}return s};var dn=Math.sqrt(3),un=Math.sqrt(5),Un=.5*(dn-1),Ie=(3-dn)/6,Qi=1/3,Ji=1/6,er=(un-1)/4,tr=(5-un)/20,ln=n=>Math.floor(n)|0,cn=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function tt(n=Math.random){let e=zn(n),t=new Float64Array(e).map(r=>cn[r%12*2]),i=new Float64Array(e).map(r=>cn[r%12*2+1]);return function(s,o){let a=0,u=0,l=0,c=(s+o)*Un,d=ln(s+c),m=ln(o+c),h=(d+m)*Ie,b=d-h,v=m-h,w=s-b,D=o-v,x,V;w>D?(x=1,V=0):(x=0,V=1);let M=w-x+Ie,y=D-V+Ie,A=w-1+2*Ie,T=D-1+2*Ie,N=d&255,I=m&255,ee=.5-w*w-D*D;if(ee>=0){let q=N+e[I],se=t[q],Ee=i[q];ee*=ee,a=ee*ee*(se*w+Ee*D)}let de=.5-M*M-y*y;if(de>=0){let q=N+x+e[I+V],se=t[q],Ee=i[q];de*=de,u=de*de*(se*M+Ee*y)}let ue=.5-A*A-T*T;if(ue>=0){let q=N+1+e[I+1],se=t[q],Ee=i[q];ue*=ue,l=ue*ue*(se*A+Ee*T)}return 70*(a+u+l)}}function zn(n){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(n()*(256-i)),s=t[i];t[i]=t[r],t[r]=s}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var nt=class{config;prng;shapeNoise;warpNoise;detailNoise;constructor(e){this.config=W({scale:1.5,lacunarity:2,persistance:.5,octaves:6,lakeProbability:.3},e),this.prng=K(this.config.seed),this.shapeNoise=tt(this.prng),this.warpNoise=tt(this.prng),this.detailNoise=tt(this.prng)}generateMap(){let{width:e,height:t,octaves:i,persistance:r,lacunarity:s,scale:o,lakeProbability:a}=this.config,u=Array.from({length:t},()=>new Array(e));for(let c=0;c<t;c++)for(let d=0;d<e;d++){let m=(d/e-.5)*2*(e/t),h=(c/t-.5)*2,b=this.warpNoise(m*1.5,h*1.5),v=this.warpNoise(m*1.5+5.2,h*1.5+1.3),D=1-Math.sqrt((m+b*.3)**2+(h+v*.3)**2);D+=this.shapeNoise(m*.8,h*.8)*.3;let x=Math.min(d,c,e-1-d,t-1-c)/(Math.min(e,t)*.1);if(D*=Math.min(1,x),D<=0){u[c][d]=0;continue}let V=0,M=1,y=o,A=0;for(let N=0;N<i;N++){let I=this.detailNoise(m*y,h*y);N>0?(I=1-Math.abs(I),I*=I):I=(I+1)/2,V+=I*M,A+=M,M*=r,y*=s}let T=V/A*D;T**=2.5,u[c][d]=Math.max(0,Math.min(1,T))}let l=this.calculateWaterBodies(u,e,t,a);return u.map((c,d)=>c.map((m,h)=>({height:m,isWater:l[d][h]})))}calculateWaterBodies(e,t,i,r){let s=Array.from({length:i},()=>new Array(t).fill(!1)),o=Array.from({length:i},()=>new Array(t).fill(!1)),a=[{min:Y.sea.threshold,max:Y.waterfront.threshold},{min:Y.waterfront.threshold,max:Y.grass.threshold},{min:Y.grass.threshold,max:Y.forest.threshold}];for(let u=0;u<i;u++)for(let l=0;l<t;l++){if(o[u][l])continue;let c=e[u][l];if(c<Y.sea.threshold){s[u][l]=!0,o[u][l]=!0;continue}for(let d of a)if(c>=d.min&&c<d.max){this.processRegion(l,u,t,i,e,o,s,d,r);break}}return s}processRegion(e,t,i,r,s,o,a,u,l){let c=[{x:e,y:t}],d=[],m=new Set;o[t][e]=!0;let h=0;for(;h<c.length;){let{x:v,y:w}=c[h++];d.push({x:v,y:w}),m.add(w*i+v);let D=[1,-1,0,0],x=[0,0,1,-1];for(let V=0;V<4;V++){let M=v+D[V],y=w+x[V];if(M>=0&&M<i&&y>=0&&y<r){let A=s[y][M];!o[y][M]&&A>=u.min&&A<u.max&&(o[y][M]=!0,c.push({x:M,y}))}}}let b=!1;for(let{x:v,y:w}of d){for(let D=-2;D<=2;D++){for(let x=-2;x<=2;x++){let V=v+x,M=w+D;if(V<0||V>=i||M<0||M>=r){b=!0;break}if(!m.has(M*i+V)&&s[M][V]<u.max){b=!0;break}}if(b)break}if(b)break}if(!b&&this.prng()<l)for(let v of d)a[v.y][v.x]=!0}};var De=class n{chunkCache=new Map;imageCache={};preloadImages(e){let t=[...Object.entries(Y),...Object.entries(et)],i=0;t.forEach(([r,s])=>{let o=new Image;o.src=s.image,o.onload=()=>{this.imageCache[r]=o,i++,i===t.length&&e()},o.onerror=()=>{console.error(`B\u0142\u0105d \u0142adowania grafiki dla: ${r} pod adresem ${s.image}`),i++,i===t.length&&e()}})}clearChunkCache(){this.chunkCache.clear()}static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var O=class n{seed=E(0);sizeX=E(1e3);sizeY=E(1e3);static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var $n=600*990,Yn=new Date("2026-01-01T00:00:00Z").getTime(),X=class n{realCurrentTimeMs=E(Date.now());dayOfYear=p(()=>Math.floor(this.gameDaysElapsed()%365));gameYear=p(()=>Math.floor(this.gameDaysElapsed()/365));timeOfDay=p(()=>this.gameDaysElapsed()%1);formattedTime=p(()=>{let e=Math.floor(this.timeOfDay()*24*60),t=Math.floor(e/60).toString().padStart(2,"0"),i=(e%60).toString().padStart(2,"0");return`${t}:${i}`});gameDaysElapsed=p(()=>{let e=this.realCurrentTimeMs()-Yn;return Math.max(0,e/$n)});tick(e=Date.now()){this.realCurrentTimeMs.set(e)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var R=class n{propertiesService=g(O);dayService=g(X);season=p(()=>{let e=this.dayService.dayOfYear();return e>=60&&e<152?"Wiosna":e>=152&&e<244?"Lato":e>=244&&e<335?"Jesie\u0144":"Zima"});sunElevation=p(()=>{let e=Math.sin((this.dayService.timeOfDay()-.25)*2*Math.PI),t=this.seasonFactor()*.2;return Math.max(-1,Math.min(1,e+t))});moonPhase=p(()=>this.dayService.gameDaysElapsed()/29.5%1);moonElevation=p(()=>{let e=(this.dayService.timeOfDay()-this.moonPhase()+1)%1;return Math.sin((e-.25)*2*Math.PI)});cloudiness=p(()=>{let e=this.weatherNoise(),t=this.seasonFactor()*-.3;return Math.max(0,Math.min(1,e+t))});rainPercentage=p(()=>{let e=this.cloudiness();if(e<.6)return 0;let t=this.season()==="Zima"||this.season()==="Jesie\u0144"?1.2:.5;return Math.min(1,(e-.6)/.4*t)});temperature=p(()=>{let e=21+this.seasonFactor()*11,i=6*Math.sin((this.dayService.timeOfDay()-.375)*2*Math.PI),r=this.sunElevation()>0?this.cloudiness()*-3:this.cloudiness()*2;return Math.round((e+i+r)*10)/10});humidity=p(()=>{let e=this.rainPercentage()*30,t=this.sunElevation()<0?10:0;return Math.max(0,Math.min(100,Math.round(55+e+t)))});sunBrightness=p(()=>{let e,t=this.sunElevation();if(t>0)e=t;else{let i=this.moonElevation();if(i>0){let r=1-Math.abs((this.moonPhase()-.5)*2);e=i*.1*r}else e=.02}return Math.max(0,Math.min(1,e))});brightness=p(()=>{let e=1-this.cloudiness()*.4;return Math.max(0,Math.min(1,this.sunBrightness()*e))});tideLevel=p(()=>{let e=.6+(1-Math.abs((this.moonPhase()-.5)*2))*.4;return Math.sin(this.dayService.gameDaysElapsed()*4*Math.PI-this.moonPhase()*2*Math.PI)*e});seasonFactor=p(()=>Math.sin((this.dayService.dayOfYear()-80)/365*2*Math.PI));weatherNoise=p(()=>{let e=this.propertiesService.seed(),t=Math.floor(this.dayService.gameDaysElapsed()),i=this.dayService.gameDaysElapsed()%1,r=K(e+t)(),s=K(e+t+1)();return r+(s-r)*i});static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var xt=(n,e,t,i,r)=>{let s=(c,d)=>{let m=Math.max(0,Math.min(c,i)),h=Math.max(0,Math.min(d,r));return n[h][m].height},o=150*Math.PI/180,a=Math.cos(o),u=Math.sin(o),l=(c,d)=>{let m=s(c+1,d)-s(c-1,d),h=s(c,d+1)-s(c,d-1);return(m*a+h*u)*20};return{shadeTL:l(e,t),shadeTR:l(e+1,t),shadeBL:l(e,t+1),shadeBR:l(e+1,t+1)}};var we=(n,e,t,i,r,s,o)=>{let a=r/32,u=(1-a)*o.shadeTL+a*o.shadeTR,l=(1-a)*o.shadeBL+a*o.shadeBR,c=(1-s)*u+s*l;if(Math.abs(c)>.01){let d=Math.min(Math.abs(c),1)*.5;n.globalCompositeOperation="overlay",n.fillStyle=c<0?`rgba(255, 255, 255, ${d})`:`rgba(0, 0, 0, ${d})`,n.fillRect(e,t,i,i),n.globalCompositeOperation="source-over"}};var hn=(n,e,t,i,r,s,o,a,u)=>{for(let l=0;l<32;l+=u){let c=Math.floor(r+l*s);if(c+o<0||c>n.height+1)continue;let d=l/32;for(let m=0;m<32;m+=u){let h=Math.floor(i+m*s);if(h+o<0||h>n.width+1)continue;let b=t[l][m];b&&(e.fillStyle=Me({height:b.height,isWater:b.isWater}),e.fillRect(h,c,o,o),we(e,h,c,o,m,d,a))}}};var pn=(n,e,t,i,r,s,o,a,u,l)=>{for(let c=0;c<32;c++){let d=Math.floor(u+c*l);if(!(d+l*2<0||d>t.height+l))for(let m=0;m<32;m++){let h=Math.floor(a+m*l);if(h+l*2<0||h>t.width+l)continue;let b=r[c][m];if(!b?.plant)continue;let v=e.imageCache[b.plant],w=tn(b.plant);if(v&&w){let D=s*32+m,x=o*32+c,M=K(n,D+100,x+100)()*.1*2-.1,y=w.imageScale??1,A=y+M*y,T=l*A,N=1+.2-A,I=K(n,D,x)(),ee=K(n,x,D)(),de=(I-.5)*l*N,ue=(ee-.5)*l*N,q=(l-T)/2,{isWater:se}=b;se&&(i.save(),i.globalAlpha=.4),i.drawImage(v,h+q+de,d+q+ue,T,T),se&&i.restore()}}}};var fn=(n,e,t,i,r,s,o,a,u,l)=>{for(let c=0;c<32;c+=l){let d=Math.floor(s+c*o);if(d+o<0||d>e.height+1)continue;let m=c/32;for(let h=0;h<32;h+=l){let b=Math.floor(r+h*o);if(b+o<0||b>e.width+1)continue;let v=i[c][h];if(!v)continue;let w=v.isWater?"sea":ve(v.height),D=n.imageCache[w];D?t.drawImage(D,b,d,a,a):(t.fillStyle=Me({height:v.height,isWater:v.isWater}),t.fillRect(b,d,a,a)),we(t,b,d,a,h,m,u)}}};var J=class n{cacheService=g(De);weatherService=g(R);propertiesService=g(O);terrain=E([]);cameraPos=E({posX:0,posY:0});zoomLevel=E(500);animationFrameId=E(null);regenerateMap(e,t){let i=t===this.propertiesService.seed()?Math.floor(Math.random()*1e9):t;this.propertiesService.seed.set(i),this.cacheService.clearChunkCache();let r=new nt({width:this.propertiesService.sizeX(),height:this.propertiesService.sizeY(),seed:this.propertiesService.seed(),scale:1,lacunarity:2,persistance:.45,octaves:6,lakeProbability:.5});this.terrain.set(r.generateMap()),this.centerCamera(e),this.drawViewport(e)}centerCamera(e){this.cameraPos.set({posX:this.propertiesService.sizeX()/2,posY:this.propertiesService.sizeY()/2}),this.zoomLevel.set(e.width/2)}drawViewport(e){let t=this.animationFrameId();t&&cancelAnimationFrame(t),this.animationFrameId.set(requestAnimationFrame(()=>{this.renderMainView(e)}))}renderMainView(e){let t=e.getContext("2d",{alpha:!1}),i=this.terrain();if(!t||!i.length)return;let{width:r,height:s}=e,o=this.zoomLevel(),a=this.cameraPos(),u=r/2,l=s/2;t.fillStyle="#0f172a",t.fillRect(0,0,r,s);let c=Math.floor(a.posX-u/o)-1,d=Math.floor(a.posX+u/o)+1,m=Math.floor(a.posY-l/o)-1,h=Math.floor(a.posY+l/o)+1,b=[],v=1;o<60?v=32:o<80?v=16:o<120?v=8:o<200?v=4:o<300&&(v=2);let w=i.length-1,D=i[0].length-1;for(let y=m;y<=h;y++)if(!(y<0||y>=i.length))for(let A=c;A<=d;A++){if(A<0||A>=i[0].length)continue;let T=Math.floor((A-a.posX)*o+u),N=Math.floor((y-a.posY)*o+l);if(v<32){let I=this.renderDetailedChunkBase(e,t,A,y,T,N,o,v);I&&o>=400&&b.push({chunk:I,tx:A,ty:y,sX:T,sY:N,objSize:o/32})}else{let I=Math.ceil(o);t.fillStyle=Me(i[y][A]),t.fillRect(T,N,I,I);let ee=xt(i,A,y,D,w);we(t,T,N,I,0,0,ee)}}let x=this.propertiesService.seed();for(let y of b)pn(x,this.cacheService,e,t,y.chunk,y.tx,y.ty,y.sX,y.sY,y.objSize);let V=this.weatherService.brightness(),M=Math.max(0,(1-V)*.8);M>0&&(t.save(),t.globalCompositeOperation="multiply",t.fillStyle=`rgba(30, 40, 90, ${M})`,t.fillRect(0,0,e.width,e.height),t.globalCompositeOperation="source-over",t.fillStyle=`rgba(0, 0, 0, ${M*.3})`,t.fillRect(0,0,e.width,e.height),t.restore())}renderDetailedChunkBase(e,t,i,r,s,o,a,u){let l=this.terrain(),c=l.length-1,d=l[0].length-1,m=`${i}_${r}_${this.propertiesService.seed()}`,h=this.cacheService.chunkCache.get(m);if(!h){let V=l[r][i],M=i+1<=d?l[r][i+1]:V,y=r+1<=c?l[r+1][i]:V,A=r+1<=c&&i+1<=d?l[r+1][i+1]:M||y||V,T={tl:V,tr:M,bl:y,br:A};if(h=an(this.propertiesService.seed(),i,r,T,32),this.cacheService.chunkCache.set(m,h),this.cacheService.chunkCache.size>1e3){let N=this.cacheService.chunkCache.keys().next().value;N&&this.cacheService.chunkCache.delete(N)}}let b=a/32,v=b*u,D=Math.ceil(v)+1,x=xt(l,i,r,d,c);return a>=400?fn(this.cacheService,e,t,h,s,o,b,D,x,u):hn(e,t,h,s,o,b,D,x,u),h}static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var qn=["minimapCanvas"],it=class n{gameService=g(J);propertiesService=g(O);positionChange=Xe();minimapCanvasRef=qe.required("minimapCanvas");expanded=E(!0);minimapCanvas=E(null);constructor(){Ae(()=>{this.setMinimapCanvas()}),Ae(()=>{this.drawMinimapMarker()})}onMinimapClick(e){let t=e.target,i=Math.round(e.offsetX/t.clientWidth*this.propertiesService.sizeX()),r=Math.round(e.offsetY/t.clientHeight*this.propertiesService.sizeY());this.gameService.cameraPos.set({posX:i,posY:r}),this.positionChange.emit()}toggleExpanded(){this.expanded.set(!this.expanded())}setMinimapCanvas(){let e=document.createElement("canvas");on(e,this.gameService.terrain()),this.minimapCanvas.set(e);let t=this.minimapCanvasRef().nativeElement;t.width=this.propertiesService.sizeX(),t.height=this.propertiesService.sizeY()}drawMinimapMarker(){let e=this.minimapCanvasRef().nativeElement,t=this.minimapCanvas(),i=this.gameService.cameraPos();sn(e,t,i.posX,i.posY)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["minimap"]],viewQuery:function(t,i){t&1&&ze(i.minimapCanvasRef,qn,5),t&2&&$e()},outputs:{positionChange:"positionChange"},decls:5,vars:2,consts:[["minimapCanvas",""],[1,"overflow-hidden","transition-all","cursor-crosshair",3,"ngClass"],[1,"absolute","top-3","right-3","cursor-pointer",3,"click"],[1,"text-white",3,"ngClass"],[1,"block","rounded","object-contain","size-full",3,"click"]],template:function(t,i){if(t&1){let r=Ce();_(0,"div",1)(1,"div",2),H("click",function(){return G(r),j(i.toggleExpanded())}),$(2,"div",3),C(),_(3,"canvas",4,0),H("click",function(o){return G(r),j(i.onMinimapClick(o))}),C()()}t&2&&(S("ngClass",i.expanded()?"rounded-4xl size-96":"rounded-2xl size-40"),f(2),S("ngClass",i.expanded()?"svg-collapse text-2xl":"svg-expand text-xl"))},dependencies:[L,Ze],encapsulation:2})};var rt=class n{gameService=g(J);propertiesService=g(O);isDragging=E(!1);lastMousePos=E({posX:0,posY:0});onMouseDown(e){this.isDragging.set(!0),this.lastMousePos.set({posX:e.clientX,posY:e.clientY})}onMouseUp(){this.isDragging.set(!1)}onMouseMove(e,t){if(!this.isDragging())return;let i=e.clientX-this.lastMousePos().posX,r=e.clientY-this.lastMousePos().posY;this.lastMousePos.set({posX:e.clientX,posY:e.clientY});let s=i/this.gameService.zoomLevel(),o=r/this.gameService.zoomLevel();this.gameService.cameraPos.update(a=>({posX:Math.max(0,Math.min(this.propertiesService.sizeX(),a.posX-s)),posY:Math.max(0,Math.min(this.propertiesService.sizeY(),a.posY-o))})),this.gameService.drawViewport(t)}onWheel(e,t){e.preventDefault();let i=.1,r=e.deltaY>0?-1:1,s=this.gameService.zoomLevel()*(1+r*i);s=Math.max(10,Math.min(1e4,s)),this.gameService.zoomLevel.set(s),this.gameService.drawViewport(t)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};var Vn=(()=>{class n{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,i){this._renderer=t,this._elementRef=i}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(i){return new(i||n)(z(Mt),z(Ct))};static \u0275dir=Z({type:n})}return n})(),Sn=(()=>{class n extends Vn{static \u0275fac=(()=>{let t;return function(r){return(t||(t=be(n)))(r||n)}})();static \u0275dir=Z({type:n,features:[ne]})}return n})(),Ot=new _e("");var Qn={provide:Ot,useExisting:he(()=>ct),multi:!0};function Jn(){let n=Vt()?Vt().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var ei=new _e(""),ct=(()=>{class n extends Vn{_compositionMode;_composing=!1;constructor(t,i,r){super(t,i),this._compositionMode=r,this._compositionMode==null&&(this._compositionMode=!Jn())}writeValue(t){let i=t??"";this.setProperty("value",i)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(i){return new(i||n)(z(Mt),z(Ct),z(ei,8))};static \u0275dir=Z({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){i&1&&H("input",function(o){return r._handleInput(o.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(o){return r._compositionEnd(o.target.value)})},standalone:!1,features:[fe([Qn]),ne]})}return n})();function ti(n){return n==null||ni(n)===0}function ni(n){return n==null?null:Array.isArray(n)||typeof n=="string"?n.length:n instanceof Set?n.size:null}var dt=new _e(""),ii=new _e("");function ri(n){return e=>{if(e.value==null||n==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function oi(n){return e=>{if(e.value==null||n==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function si(n){return ti(n.value)?{required:!0}:null}function vn(n){return null}function En(n){return n!=null}function An(n){return Xt(n)?zt(n):n}function xn(n){let e={};return n.forEach(t=>{e=t!=null?W(W({},e),t):e}),Object.keys(e).length===0?null:e}function Fn(n,e){return e.map(t=>t(n))}function ai(n){return!n.validate}function In(n){return n.map(e=>ai(e)?e:t=>e.validate(t))}function li(n){if(!n)return null;let e=n.filter(En);return e.length==0?null:function(t){return xn(Fn(t,e))}}function Nn(n){return n!=null?li(In(n)):null}function ci(n){if(!n)return null;let e=n.filter(En);return e.length==0?null:function(t){let i=Fn(t,e).map(An);return Yt(i).pipe($t(xn))}}function Pn(n){return n!=null?ci(In(n)):null}function yn(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function di(n){return n._rawValidators}function ui(n){return n._rawAsyncValidators}function It(n){return n?Array.isArray(n)?n:[n]:[]}function st(n,e){return Array.isArray(n)?n.includes(e):n===e}function _n(n,e){let t=It(e);return It(n).forEach(r=>{st(t,r)||t.push(r)}),t}function bn(n,e){return It(e).filter(t=>!st(n,t))}var at=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Nn(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Pn(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Nt=class extends at{name;get formDirective(){return null}get path(){return null}},Oe=class extends at{_parent=null;name=null;valueAccessor=null},Pt=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}};var kn=(()=>{class n extends Pt{constructor(t){super(t)}static \u0275fac=function(i){return new(i||n)(z(Oe,2))};static \u0275dir=Z({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){i&2&&qt("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[ne]})}return n})();var Ne="VALID",ot="INVALID",Ve="PENDING",Pe="DISABLED",ye=class{},lt=class extends ye{value;source;constructor(e,t){super(),this.value=e,this.source=t}},ke=class extends ye{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},Te=class extends ye{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},Se=class extends ye{status;source;constructor(e,t){super(),this.status=e,this.source=t}};var kt=class extends ye{source;constructor(e){super(),this.source=e}};function hi(n){return(ut(n)?n.validators:n)||null}function mi(n){return Array.isArray(n)?Nn(n):n||null}function pi(n,e){return(ut(e)?e.asyncValidators:n)||null}function fi(n){return Array.isArray(n)?Pn(n):n||null}function ut(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}var Tt=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return me(this.statusReactive)}set status(e){me(()=>this.statusReactive.set(e))}_status=p(()=>this.statusReactive());statusReactive=E(void 0);get valid(){return this.status===Ne}get invalid(){return this.status===ot}get pending(){return this.status==Ve}get disabled(){return this.status===Pe}get enabled(){return this.status!==Pe}errors;get pristine(){return me(this.pristineReactive)}set pristine(e){me(()=>this.pristineReactive.set(e))}_pristine=p(()=>this.pristineReactive());pristineReactive=E(!0);get dirty(){return!this.pristine}get touched(){return me(this.touchedReactive)}set touched(e){me(()=>this.touchedReactive.set(e))}_touched=p(()=>this.touchedReactive());touchedReactive=E(!1);get untouched(){return!this.touched}_events=new Ut;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(_n(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(_n(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(bn(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(bn(e,this._rawAsyncValidators))}hasValidator(e){return st(this._rawValidators,e)}hasAsyncValidator(e){return st(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(te(W({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new Te(!0,i))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:i})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,i),t&&e.emitEvent!==!1&&this._events.next(new Te(!1,i))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(te(W({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new ke(!1,i))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,i),t&&e.emitEvent!==!1&&this._events.next(new ke(!0,i))}markAsPending(e={}){this.status=Ve;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Se(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(te(W({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Pe,this.errors=null,this._forEachChild(r=>{r.disable(te(W({},e),{onlySelf:!0}))}),this._updateValue();let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new lt(this.value,i)),this._events.next(new Se(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(te(W({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ne,this._forEachChild(i=>{i.enable(te(W({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(te(W({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ne||this.status===Ve)&&this._runAsyncValidator(i,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new lt(this.value,t)),this._events.next(new Se(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(te(W({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Pe:Ne}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Ve,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:e!==!1};let i=An(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((i,r)=>i&&i._find(r),this)}getError(e,t){let i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,i){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||i)&&this._events.next(new Se(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,i)}_initObservables(){this.valueChanges=new Ge,this.statusChanges=new Ge}_calculateStatus(){return this._allControlsDisabled()?Pe:this.errors?ot:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ve)?Ve:this._anyControlsHaveStatus(ot)?ot:Ne}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),r&&this._events.next(new ke(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Te(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ut(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=mi(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=fi(this._rawAsyncValidators)}};var Tn=new _e("",{factory:()=>Rt}),Rt="always";function gi(n,e){return[...e.path,n]}function vi(n,e,t=Rt){_i(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),bi(n,e),Mi(n,e),Ci(n,e),yi(n,e)}function Cn(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function yi(n,e){if(e.valueAccessor.setDisabledState){let t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function _i(n,e){let t=di(n);e.validator!==null?n.setValidators(yn(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let i=ui(n);e.asyncValidator!==null?n.setAsyncValidators(yn(i,e.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();Cn(e._rawValidators,r),Cn(e._rawAsyncValidators,r)}function bi(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&On(n,e)})}function Ci(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&On(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function On(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Mi(n,e){let t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function Di(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function wi(n){return Object.getPrototypeOf(n.constructor)===Sn}function Vi(n,e){if(!e)return null;Array.isArray(e);let t,i,r;return e.forEach(s=>{s.constructor===ct?t=s:wi(s)?i=s:r=s}),r||i||t||null}function Mn(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Dn(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Si=class extends Tt{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,i){super(hi(t),pi(i,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ut(t)&&(t.nonNullable||t.initialValueIsDefault)&&(Dn(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),t.overwriteDefaultValue&&(this.defaultValue=this.value),this._pendingChange=!1,t?.emitEvent!==!1&&this._events.next(new kt(this))}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Mn(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Mn(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Dn(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Ei={provide:Oe,useExisting:he(()=>Bt)},wn=Promise.resolve(),Bt=(()=>{class n extends Oe{_changeDetectorRef;callSetDisabledState;control=new Si;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Ge;constructor(t,i,r,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this._parent=t,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=Vi(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let i=t.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),Di(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){vi(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){wn.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let i=t.isDisabled.currentValue,r=i!==0&&wt(i);wn.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?gi(t,this._parent):[t]}static \u0275fac=function(i){return new(i||n)(z(Nt,9),z(dt,10),z(ii,10),z(Ot,10),z(en,8),z(Tn,8))};static \u0275dir=Z({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[fe([Ei]),ne,bt]})}return n})();var Ai={provide:Ot,useExisting:he(()=>Gt),multi:!0},Gt=(()=>{class n extends Sn{writeValue(t){let i=t??"";this.setProperty("value",i)}registerOnChange(t){this.onChange=i=>{t(i==""?null:parseFloat(i))}}static \u0275fac=(()=>{let t;return function(r){return(t||(t=be(n)))(r||n)}})();static \u0275dir=Z({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,r){i&1&&H("input",function(o){return r.onChange(o.target.value)})("blur",function(){return r.onTouched()})},standalone:!1,features:[fe([Ai]),ne]})}return n})();function Rn(n){return typeof n=="number"?n:parseFloat(n)}var jt=(()=>{class n{_validator=vn;_onChange;_enabled;ngOnChanges(t){if(this.inputName in t){let i=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):vn,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Z({type:n,features:[bt]})}return n})(),xi={provide:dt,useExisting:he(()=>Ht),multi:!0},Ht=(()=>{class n extends jt{max;inputName="max";normalizeInput=t=>Rn(t);createValidator=t=>oi(t);static \u0275fac=(()=>{let t;return function(r){return(t||(t=be(n)))(r||n)}})();static \u0275dir=Z({type:n,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&je("max",r._enabled?r.max:null)},inputs:{max:"max"},standalone:!1,features:[fe([xi]),ne]})}return n})(),Fi={provide:dt,useExisting:he(()=>Lt),multi:!0},Lt=(()=>{class n extends jt{min;inputName="min";normalizeInput=t=>Rn(t);createValidator=t=>ri(t);static \u0275fac=(()=>{let t;return function(r){return(t||(t=be(n)))(r||n)}})();static \u0275dir=Z({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&je("min",r._enabled?r.min:null)},inputs:{min:"min"},standalone:!1,features:[fe([Fi]),ne]})}return n})(),Ii={provide:dt,useExisting:he(()=>Wt),multi:!0};var Wt=(()=>{class n extends jt{required;inputName="required";normalizeInput=wt;createValidator=t=>si;enabled(t){return t}static \u0275fac=(()=>{let t;return function(r){return(t||(t=be(n)))(r||n)}})();static \u0275dir=Z({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,r){i&2&&je("required",r._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[fe([Ii]),ne]})}return n})();var Ni=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=Dt({type:n});static \u0275inj=_t({})}return n})();var Bn=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:Tn,useValue:t.callSetDisabledState??Rt}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Dt({type:n});static \u0275inj=_t({imports:[Ni]})}return n})();var jn=3e3,Gn=Y.sea.threshold*jn,ht=class n{propertiesService=g(O);gameService=g(J);regenerate=Xe();newSeed=E(0);pointHeight=p(()=>{let{posX:e,posY:t}=this.gameService.cameraPos();return(this.gameService.terrain()?.[Math.round(t)]?.[Math.round(e)]?.height??0)*(jn+Gn)-Gn});constructor(){Ae(()=>{this.newSeed.set(this.propertiesService.seed())})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["info"]],outputs:{regenerate:"regenerate"},decls:19,vars:21,consts:[["seedInput",""],[1,"size-full","p-4","shadow-xl","pointer-events-auto"],[1,"flex","flex-col","gap-2"],[1,"text-xs","text-slate-400","font-mono","mt-1","space-y-1"],["type","number",1,"bg-slate-800","text-slate-200","p-1","rounded","w-24","text-center",3,"ngModelChange","required","min","max","ngModel"],[1,"px-4","py-2","bg-indigo-600","hover:bg-indigo-500","text-white","rounded-lg","transition","cursor-pointer","shadow-lg","active:scale-95","disabled:pointer-events-none","disabled:opacity-30",3,"click","disabled"]],template:function(t,i){if(t&1){let r=Ce();_(0,"div",1)(1,"div",2)(2,"div",3)(3,"div"),F(4," Seed: "),_(5,"input",4,0),Qt("ngModelChange",function(o){return G(r),Kt(i.newSeed,o)||(i.newSeed=o),j(o)}),C()(),_(7,"div"),F(8),ae(9,"number"),ae(10,"number"),C(),_(11,"div"),F(12),ae(13,"number"),C(),_(14,"div"),F(15),ae(16,"number"),C()(),_(17,"button",5),H("click",function(){return G(r),j(i.regenerate.emit(i.newSeed()))}),F(18," Generuj "),C()()()}if(t&2){let r=pe(6);f(5),S("required",!0)("min",0)("max",999999999),Zt("ngModel",i.newSeed),f(3),Ye(" Pozycja: ",le(9,9,i.gameService.cameraPos().posX,"1.0-0")," x ",le(10,12,i.gameService.cameraPos().posY,"1.0-0")," "),f(4),re("Zoom: ",le(13,15,i.gameService.zoomLevel(),"1.0-0")),f(3),re("Wysoko\u015B\u0107: ",le(16,18,i.pointHeight(),"1.0-0")," m n.p.m."),f(2),S("disabled",!r.validity.valid)}},dependencies:[L,Bn,ct,Gt,kn,Wt,Lt,Ht,Bt,Qe],encapsulation:2})};var Re=(n,e,t,i)=>{let r=Math.round(n[0]+(e[0]-n[0])*t),s=Math.round(n[1]+(e[1]-n[1])*t),o=Math.round(n[2]+(e[2]-n[2])*t);return i===void 0?`rgb(${r}, ${s}, ${o})`:`rgba(${r}, ${s}, ${o}, ${i})`};var Be=n=>({"background-color":n}),mt=class n{weather=g(R);cloudRGB=p(()=>Re([92,92,92],[217,217,217],this.weather.brightness(),this.weather.cloudiness()));static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["clouds"]],decls:7,vars:15,consts:[[1,"animate-cloud-left"],[1,"absolute","top-12","left-[-20%]","w-80","h-24","rounded-full","blur-2xl","transition-colors","duration-1000","ease-linear",3,"ngStyle"],[1,"absolute","top-32","left-[10%]","w-100","h-32","rounded-full","blur-2xl","transition-colors","duration-1000","ease-linear",3,"ngStyle"],[1,"absolute","top-0","left-[10%]","w-96","h-28","rounded-full","blur-2xl","transition-colors","duration-1000","ease-linear",3,"ngStyle"],[1,"animate-cloud-right"],[1,"absolute","top-0","left-[-10%]","w-96","h-40","rounded-full","blur-2xl","transition-colors","duration-1000","ease-linear",3,"ngStyle"]],template:function(t,i){t&1&&(_(0,"div",0),$(1,"div",1)(2,"div",2)(3,"div",3),C(),_(4,"div",4),$(5,"div",5)(6,"div",2),C()),t&2&&(f(),S("ngStyle",oe(5,Be,i.cloudRGB())),f(),S("ngStyle",oe(7,Be,i.cloudRGB())),f(),S("ngStyle",oe(9,Be,i.cloudRGB())),f(2),S("ngStyle",oe(11,Be,i.cloudRGB())),f(),S("ngStyle",oe(13,Be,i.cloudRGB())))},dependencies:[L,Ke],encapsulation:2})};function ki(n,e){if(n&1&&ie(0,"div",1),n&2){let t=e.$implicit;Q("left",t.left)("animation-duration",t.duration)("animation-delay",t.delay)("opacity",t.opacity)}}var pt=class n{weather=g(R);rainDrops=p(()=>{let e=this.weather.rainPercentage()*100,t=Math.floor(e*2);return Array.from({length:t}).map(()=>({left:`${Math.random()*100}%`,duration:`${1.1-e/100}s`,opacity:.1+Math.random()*.5,delay:`${Math.random()*2}s`}))});static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["rain"]],decls:2,vars:0,consts:[[1,"absolute","bg-blue-100","w-px","h-5","bottom-full","animate-fall",3,"left","animation-duration","animation-delay","opacity"],[1,"absolute","bg-blue-100","w-px","h-5","bottom-full","animate-fall"]],template:function(t,i){t&1&&Le(0,ki,1,8,"div",0,He),t&2&&We(i.rainDrops())},encapsulation:2})};var ft=class n{dayService=g(X);weather=g(R);skyRGB=Jt.required();moonX=p(()=>(this.dayService.timeOfDay()-this.weather.moonPhase()+1)%1*150-25);moonY=p(()=>-(this.weather.moonElevation()-1)*55+5);shadowTransform=p(()=>{let e=this.weather.moonPhase(),t,i=105;return e<=.5?t=-(e*2)*i:t=(1-e)*2*i,`translateX(${t}%)`});static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["moon"]],inputs:{skyRGB:[1,"skyRGB"]},decls:10,vars:8,consts:[[1,"absolute","size-12","rounded-full","transition-all","duration-1000","ease-linear","z-10","overflow-hidden"],[1,"absolute","inset-1","bg-slate-100","rounded-full","overflow-hidden","size-10","shadow-[0_0_3px_1px","rgba(255,","255,","255,","0.5)]"],[1,"absolute","inset-0","opacity-10","bg-[radial-gradient(circle_at_60%_60%,#94a3b8_0%,transparent_50%)]"],[1,"absolute","top-[60%]","left-[25%]","size-3","rounded-full","bg-slate-300/40","shadow-[inset_1px_1px_2px_rgba(0,0,0,0.1)]","blur-[0.5px]"],[1,"absolute","top-[30%]","left-[55%]","size-2","rounded-full","bg-slate-300/30","shadow-[inset_-1px_-1px_1px_rgba(0,0,0,0.1)]"],[1,"absolute","top-[20%]","left-[30%]","size-1.5","rounded-full","bg-slate-400/20"],[1,"absolute","top-[60%]","left-[60%]","size-1","rounded-full","bg-slate-400/25"],[1,"absolute","top-[45%]","left-[15%]","size-2.5","rounded-full","bg-slate-300/30","blur-[0.2px]"],[1,"absolute","top-[15%]","left-[45%]","w-5","h-3","rotate-[-20deg]","rounded-full","bg-slate-400/10","blur-md"],[1,"absolute","inset-0","rounded-full","transition-all","duration-1000","ease-linear","z-20","blur-xs","size-12"]],template:function(t,i){t&1&&(Ue(0,"div",0)(1,"div",1),ie(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8),xe(),ie(9,"div",9),xe()),t&2&&(Q("left",i.moonX(),"%")("top",i.moonY(),"%"),f(9),Q("background-color",i.skyRGB())("transform",i.shadowTransform()))},dependencies:[L],encapsulation:2})};var gt=class n{dayService=g(X);weather=g(R);sunX=p(()=>this.dayService.timeOfDay()*150-25);sunY=p(()=>-(this.weather.sunElevation()-1)*55+5);static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["sun"]],decls:1,vars:4,consts:[[1,"absolute","-ml-7","w-14","h-14","bg-[#f6bb42]","rounded-full","shadow-[0_0_30px_#f6bb42]","transition-all","duration-1000","ease-linear"]],template:function(t,i){t&1&&ie(0,"div",0),t&2&&Q("left",i.sunX(),"%")("top",i.sunY(),"%")},encapsulation:2})};function Ti(n,e){if(n&1&&ie(0,"div",2),n&2){let t=e.$implicit;Q("left",t.posX,"%")("top",t.posY,"%")("width",t.size,"px")("height",t.size,"px")("animation-duration",t.duration,"s")}}var vt=class n{weather=g(R);propertiesService=g(O);stars=p(()=>{let e=this.propertiesService.seed(),t=[];for(let i=0;i<100;i++){let r=Math.sin(e+i)*1e4%100,s=Math.cos(e+i*2)*1e4%75,o=Math.abs(Math.sin(e-i)*3),a=3+Math.abs(Math.sin(i)*12);t.push({posX:Math.abs(r),posY:Math.abs(s),size:o,duration:a})}return t});starsOpacity=p(()=>{let e=this.weather.brightness();return Math.max(0,1-e*3.3)});static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["stars"]],decls:3,vars:2,consts:[[1,"absolute","inset-0","z-0","pointer-events-none","transition-opacity","duration-1000"],[1,"absolute","bg-white","rounded-full","animate-twinkle",3,"left","top","width","height","animation-duration"],[1,"absolute","bg-white","rounded-full","animate-twinkle"]],template:function(t,i){t&1&&(Ue(0,"div",0),Le(1,Ti,1,10,"div",1,He),xe()),t&2&&(Q("opacity",i.starsOpacity()),f(),We(i.stars()))},dependencies:[L],encapsulation:2})};var Hn=n=>({"background-color":n}),yt=class n{weatherService=g(R);dayService=g(X);skyRGB=p(()=>Re([15,23,42],[56,139,255],this.weatherService.brightness()));grassRGB=p(()=>Re([50,60,42],[100,160,62],this.weatherService.brightness(),.6));expanded=E(!0);toggleExpanded(){this.expanded.set(!this.expanded())}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["weather"]],decls:56,vars:34,consts:[[1,"overflow-hidden","bg-slate-900","cursor-pointer","transition-all",3,"click","ngClass"],[1,"size-full","relative","shadow-2xl","duration-1000","ease-linear","transition-colors",3,"ngStyle"],[1,"absolute","inset-x-0","top-0","w-full","transition-all","z-0",3,"ngClass"],[1,"relative","size-full","block"],[1,"relative","size-full","block",3,"skyRGB"],[1,"relative","w-full","min-h-96"],[1,"absolute","inset-0","pointer-events-none","z-10"],[1,"absolute","inset-0","pointer-events-none","overflow-hidden","z-50"],[1,"absolute","inset-0","z-30","flex","flex-col","justify-between","pointer-events-none"],[1,"flex","justify-end","drop-shadow-md","text-white","transition-all","px-6",3,"ngClass"],[1,"absolute","left-6"],[1,"font-bold","tracking-tighter","transition-all",3,"ngClass"],[1,"flex","gap-6","justify-between","font-light","text-center"],[1,"transition-all",3,"ngClass"],[1,"text-xl"],[1,"text-sm"],[1,"text-sm","transition-all",3,"ngClass"],[1,"backdrop-blur-xl","p-6","text-white","drop-shadow-lg","pointer-events-auto","transition-colors","duration-1000","ease-linear","flex","flex-col","gap-4",3,"ngStyle"],[1,"flex","justify-between","items-center"],[1,"text-lg","font-medium"],[1,"inline-block","mt-2","px-4","py-1","bg-white/20","rounded-full","text-sm","font-semibold","backdrop-blur-md","border","border-white/10","shadow-sm"],[1,"grid","grid-cols-3"],[1,"flex","flex-col","items-center"],[1,"text-xs","uppercase","opacity-70","mb-1","font-semibold","tracking-wider"],[1,"font-bold","text-xl"],[1,"font-bold","text-xl","text-blue-400"]],template:function(t,i){t&1&&(_(0,"div",0),H("click",function(){return i.toggleExpanded()}),_(1,"div",1)(2,"div",2),$(3,"sun",3),C(),_(4,"div",2),$(5,"moon",4),C(),_(6,"div",5),$(7,"stars"),C(),$(8,"clouds",6)(9,"rain",7),_(10,"div",8)(11,"div",9)(12,"div",10)(13,"h1",11),F(14),C()(),_(15,"div",12)(16,"div",13)(17,"div",14),F(18),C(),_(19,"div",15),F(20,"Rok"),C()(),_(21,"div",13)(22,"div",14),F(23),C(),_(24,"div",15),F(25,"Dzie\u0144"),C()(),_(26,"div")(27,"div",13),F(28),C(),_(29,"div",16),F(30),C()()()(),_(31,"div",13)(32,"div",17)(33,"div",18)(34,"p",19),F(35),C(),_(36,"span",20),F(37),C()(),_(38,"div",21)(39,"div",22)(40,"span",23),F(41,"Wilgotno\u015B\u0107"),C(),_(42,"span",24),F(43),C()(),_(44,"div",22)(45,"span",23),F(46,"Chmury"),C(),_(47,"span",24),F(48),ae(49,"number"),C()(),_(50,"div",22)(51,"span",23),F(52,"Opady"),C(),_(53,"span",25),F(54),ae(55,"number"),C()()()()()()()()),t&2&&(S("ngClass",i.expanded()?"rounded-4xl size-96":"rounded-2xl h-20 w-96"),f(),S("ngStyle",oe(30,Hn,i.skyRGB())),f(),S("ngClass",i.expanded()?"h-96":"h-40"),f(2),S("ngClass",i.expanded()?"h-96":"h-40"),f(),S("skyRGB",i.skyRGB()),f(6),S("ngClass",i.expanded()?"py-6":"py-4"),f(2),S("ngClass",i.expanded()?"text-6xl":"text-5xl"),f(),Fe(i.dayService.formattedTime()),f(2),S("ngClass",i.expanded()?"opacity-0":"opacity-100"),f(2),Fe(i.dayService.gameYear()),f(3),S("ngClass",i.expanded()?"opacity-0":"opacity-100"),f(2),Fe(i.dayService.dayOfYear()),f(4),S("ngClass",i.expanded()?"text-5xl":"text-xl"),f(),re("",i.weatherService.temperature(),"\xB0C"),f(),S("ngClass",i.expanded()?"opacity-0":"opacity-100"),f(),Fe(i.weatherService.season()),f(),S("ngClass",i.expanded()?"opacity-100":"opacity-0"),f(),S("ngStyle",oe(32,Hn,i.grassRGB())),f(3),Ye("Rok ",i.dayService.gameYear(),", Dzie\u0144 ",i.dayService.dayOfYear()),f(2),re(" ",i.weatherService.season()," "),f(6),re("",i.weatherService.humidity(),"%"),f(5),re("",le(49,24,i.weatherService.cloudiness()*100,"1.0-0"),"%"),f(6),re("",le(55,27,i.weatherService.rainPercentage()*100,"1.0-0"),"%"))},dependencies:[L,Ze,Ke,mt,pt,ft,gt,vt,Qe],encapsulation:2})};var Oi=["mainCanvas"],Ln=class n{mouseService=g(rt);gameService=g(J);cacheService=g(De);dayService=g(X);propertiesService=g(O);mainCanvasRef=qe.required("mainCanvas");tickInterval;constructor(){this.cacheService.preloadImages(()=>{this.gameService.drawViewport(this.mainCanvasRef().nativeElement)}),this.tickInterval=setInterval(()=>{this.dayService.tick(),this.gameService.drawViewport(this.mainCanvasRef().nativeElement)},1e3)}ngAfterViewInit(){this.resizeMainCanvas(),window.addEventListener("resize",()=>{this.resizeMainCanvas(),this.gameService.drawViewport(this.mainCanvasRef().nativeElement)}),this.gameService.regenerateMap(this.mainCanvasRef().nativeElement,this.propertiesService.seed())}ngOnDestroy(){clearInterval(this.tickInterval)}resizeMainCanvas(){let e=this.mainCanvasRef().nativeElement;e.width=window.innerWidth,e.height=window.innerHeight}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["game-page"]],viewQuery:function(t,i){t&1&&ze(i.mainCanvasRef,Oi,5),t&2&&$e()},decls:6,vars:0,consts:[["mainCanvas",""],[1,"relative","w-full","h-screen","bg-slate-900","overflow-hidden","select-none","font-sans"],[1,"absolute","inset-0","z-0","cursor-crosshair","active:cursor-grabbing",3,"mousedown","mousemove","mouseup","mouseleave","wheel"],[1,"absolute","top-4","left-4","z-10"],[1,"absolute","top-4","right-4","z-20",3,"positionChange"],[1,"absolute","bottom-4","left-4","z-10","rounded-2xl","w-60","overflow-hidden","bg-slate-900",3,"regenerate"]],template:function(t,i){if(t&1){let r=Ce();_(0,"div",1)(1,"canvas",2,0),H("mousedown",function(o){return G(r),j(i.mouseService.onMouseDown(o))})("mousemove",function(o){G(r);let a=pe(2);return j(i.mouseService.onMouseMove(o,a))})("mouseup",function(){return G(r),j(i.mouseService.onMouseUp())})("mouseleave",function(){return G(r),j(i.mouseService.onMouseUp())})("wheel",function(o){G(r);let a=pe(2);return j(i.mouseService.onWheel(o,a))}),C(),$(3,"weather",3),_(4,"minimap",4),H("positionChange",function(){G(r);let o=pe(2);return j(i.gameService.drawViewport(o))}),C(),_(5,"info",5),H("regenerate",function(o){G(r);let a=pe(2);return j(i.gameService.regenerateMap(a,o))}),C()()}},dependencies:[L,it,ht,yt],encapsulation:2})};export{Ln as GamePage};
